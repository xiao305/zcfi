<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网站配置 | zcfi.cn</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon/favicon-96x96.png">
    <link rel="icon" type="image/x-icon" href="../favicon/favicon.ico">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 后台公共CSS -->
    <link rel="stylesheet" href="assets/css/admin-common.css">
    
    <style>
        /* 配置管理特定样式 */
        .config-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }
        
        .config-sidebar {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
        }
        
        .config-nav {
            list-style: none;
        }
        
        .config-nav li {
            margin-bottom: 5px;
        }
        
        .config-nav a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            color: #495057;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .config-nav a:hover {
            background: #e9ecef;
            color: #4a6fa5;
        }
        
        .config-nav a.active {
            background: #4a6fa5;
            color: white;
        }
        
        .config-nav i {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .config-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .config-section {
            display: none;
        }
        
        .config-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .section-header h2 {
            color: #333;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-header p {
            color: #6c757d;
            margin-top: 8px;
            font-size: 14px;
        }
        
        /* 紧凑的表单样式 */
        .compact-form .form-group {
            margin-bottom: 15px;
        }
        
        .compact-form .form-group label {
            font-size: 14px;
            margin-bottom: 6px;
        }
        
        .compact-form input,
        .compact-form textarea {
            padding: 10px 12px;
            font-size: 14px;
        }
        
        /* 开关控件 */
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-label {
            font-size: 14px;
            color: #495057;
        }
        
        .toggle-container {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .toggle-checkbox {
            display: none;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .toggle-checkbox:checked + .toggle-slider {
            background-color: #4a6fa5;
        }
        
        .toggle-checkbox:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* 操作按钮组 */
        .section-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            flex-wrap: wrap;
        }
        
        /* 预览区域 */
        .preview-area {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .preview-area h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .preview-content {
            font-size: 14px;
            line-height: 1.6;
            color: #495057;
        }
        
        /* 富文本编辑器样式 */
        .editor-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            flex-wrap: wrap;
        }
        
        .editor-btn {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            color: #495057;
        }
        
        .editor-btn:hover {
            background: #f8f9fa;
            border-color: #4a6fa5;
            color: #4a6fa5;
        }
        
        .editor-btn i {
            font-size: 14px;
        }
        
        /* 快捷标签按钮组 */
        .quick-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }
        
        .tag-btn {
            background: #e9ecef;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #495057;
        }
        
        .tag-btn:hover {
            background: #4a6fa5;
            color: white;
        }
        
        /* 刷新按钮区域 */
        .refresh-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        /* 新增：导航项表单样式 */
        .nav-item-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .nav-item-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .nav-item-name {
            min-width: 120px;
        }
        
        .nav-item-url {
            min-width: 200px;
        }
        
        .btn-sm {
            padding: 8px 12px !important;
            font-size: 13px !important;
        }
        
        /* 新增：导航预览样式 */
        .nav-preview {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .nav-preview-logo {
            font-weight: bold;
            color: #4a6fa5;
            font-size: 18px;
        }
        
        .nav-preview-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-preview-link {
            color: #4a6fa5;
            text-decoration: none;
        }
        
        .nav-preview-link:hover {
            text-decoration: underline;
        }
        
        .nav-preview-menu-btn {
            background: none;
            border: none;
            color: #4a6fa5;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* 新增：页脚预览样式 */
        .footer-preview {
            background: #333344;
            color: white;
            padding: 30px;
            border-radius: 5px;
        }
        
        .footer-preview-content {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .footer-preview-logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .footer-preview-desc {
            color: #aaa;
            margin-bottom: 15px;
        }
        
        .footer-preview-links h4 {
            margin-bottom: 10px;
            color: white;
        }
        
        .footer-preview-links ul {
            list-style: none;
            padding: 0;
            color: #aaa;
        }
        
        .footer-preview-links a {
            color: #aaa;
            text-decoration: none;
        }
        
        .footer-preview-links a:hover {
            color: #4a6fa5;
        }
        
        .footer-preview-copyright {
            border-top: 1px solid #444;
            padding-top: 15px;
            text-align: center;
            color: #aaa;
        }
        
        /* 响应式设计 */
        @media (max-width: 992px) {
            .config-layout {
                grid-template-columns: 1fr;
            }
            
            .config-sidebar {
                position: sticky;
                top: 20px;
                z-index: 100;
            }
            
            .config-nav {
                display: flex;
                overflow-x: auto;
                gap: 10px;
                padding-bottom: 10px;
            }
            
            .config-nav li {
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .config-nav a {
                white-space: nowrap;
            }
        }
        
        @media (max-width: 768px) {
            .config-content {
                padding: 20px;
            }
            
            .section-actions {
                flex-direction: column;
            }
            
            .section-actions button {
                width: 100%;
            }
            
            .editor-toolbar {
                padding: 8px;
            }
            
            .editor-btn {
                padding: 6px 8px;
                font-size: 12px;
            }
            
            .nav-item-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .nav-item-row input {
                width: 100%;
            }
        }
    </style>
</head>
<body class="admin-body">
    <div class="admin-container">
        <div class="admin-header">
            <a href="index.html" class="nav-back">
                <i class="fas fa-arrow-left"></i> 返回
            </a>
            <a href="https://zcfi.cn" class="admin-logo">zcfi<span>.</span>cn</a>
            <div class="header-title">
                <h1><i class="fas fa-cog"></i> 网站配置</h1>
                <p>管理网站基本信息和页面内容</p>
            </div>
        </div>
        
        <div class="admin-main-content">
            <!-- 刷新按钮区域 -->
            <div class="refresh-section">
                <div class="admin-button-group">
                    <button class="admin-btn btn-secondary" id="refreshConfigBtn">
                        <i class="fas fa-sync-alt"></i> 刷新配置
                    </button>
                    <button class="admin-btn btn-info" id="backupConfigBtn">
                        <i class="fas fa-download"></i> 备份配置
                    </button>
                </div>
            </div>
            
            <div class="config-layout">
                <!-- 左侧导航 -->
                <div class="config-sidebar">
                    <ul class="config-nav">
                        <li><a href="#site-info" class="active">
                            <i class="fas fa-info-circle"></i> 网站信息
                        </a></li>
                        <li><a href="#privacy-policy">
                            <i class="fas fa-shield-alt"></i> 隐私政策
                        </a></li>
                        <li><a href="#terms-of-service">
                            <i class="fas fa-file-contract"></i> 使用条款
                        </a></li>
                        <li><a href="#copyright">
                            <i class="fas fa-copyright"></i> 版权声明
                        </a></li>
                        <li><a href="#social-links">
                            <i class="fas fa-share-alt"></i> 社交链接
                        </a></li>
                        <!-- 新增：导航栏和页脚配置 -->
                        <li><a href="#navigation">
                            <i class="fas fa-bars"></i> 导航栏配置
                        </a></li>
                        <li><a href="#footer">
                            <i class="fas fa-shoe-prints"></i> 页脚配置
                        </a></li>
                    </ul>
                    
                    <div style="margin-top: 30px; padding: 15px; background: #e9ecef; border-radius: 8px;">
                        <h4 style="font-size: 14px; margin-bottom: 10px; color: #495057;">配置说明</h4>
                        <p style="font-size: 12px; color: #6c757d; line-height: 1.5;">
                            所有配置保存到独立的 Gist 中。<br>
                            保存后，前台页面会实时加载更新。
                        </p>
                    </div>
                </div>
                
                <!-- 右侧内容 -->
                <div class="config-content">
                    <!-- 网站信息 -->
                    <div class="config-section active" id="site-info-section">
                        <div class="section-header">
                            <h2><i class="fas fa-info-circle"></i> 网站基本信息</h2>
                            <p>配置网站的名称、描述和联系信息</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="siteName"><i class="fas fa-globe"></i> 网站名称</label>
                                <input type="text" id="siteName" placeholder="例如：我的个人网站">
                            </div>
                            
                            <div class="form-group">
                                <label for="siteDescription"><i class="fas fa-align-left"></i> 网站描述</label>
                                <textarea id="siteDescription" placeholder="网站的简短描述，用于 SEO 和社交媒体分享" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="siteKeywords"><i class="fas fa-tags"></i> 网站关键词</label>
                                <input type="text" id="siteKeywords" placeholder="例如：个人网站,技术博客,作品展示">
                                <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
                                    使用逗号分隔多个关键词
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="adminEmail"><i class="fas fa-envelope"></i> 管理员邮箱</label>
                                <input type="email" id="adminEmail" placeholder="admin@example.com">
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('site-info')">
                                <i class="fas fa-save"></i> 保存网站信息
                            </button>
                            <button class="admin-btn btn-secondary" onclick="resetCurrentSection('site-info')">
                                <i class="fas fa-undo"></i> 重置
                            </button>
                        </div>
                    </div>
                    
                    <!-- 隐私政策 -->
                    <div class="config-section" id="privacy-policy-section">
                        <div class="section-header">
                            <h2><i class="fas fa-shield-alt"></i> 隐私政策</h2>
                            <p>编辑网站隐私政策内容，支持 HTML 格式</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="privacyTitle"><i class="fas fa-heading"></i> 页面标题</label>
                                <input type="text" id="privacyTitle" placeholder="隐私政策">
                            </div>
                            
                            <!-- 快捷HTML标签 -->
                            <div class="quick-tags">
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'h3')">h3标题</button>
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'p')">段落</button>
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'strong')">加粗</button>
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'em')">斜体</button>
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'ul')">列表</button>
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'li')">列表项</button>
                                <button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'a')">链接</button>
                            </div>
                            
                            <!-- 富文本编辑器工具栏 -->
                            <div class="editor-toolbar">
                                <button type="button" class="editor-btn" onclick="formatText('privacyContent', 'bold')">
                                    <i class="fas fa-bold"></i> 加粗
                                </button>
                                <button type="button" class="editor-btn" onclick="formatText('privacyContent', 'italic')">
                                    <i class="fas fa-italic"></i> 斜体
                                </button>
                                <button type="button" class="editor-btn" onclick="formatText('privacyContent', 'underline')">
                                    <i class="fas fa-underline"></i> 下划线
                                </button>
                                <button type="button" class="editor-btn" onclick="formatText('privacyContent', 'link')">
                                    <i class="fas fa-link"></i> 链接
                                </button>
                                <button type="button" class="editor-btn" onclick="formatText('privacyContent', 'list')">
                                    <i class="fas fa-list"></i> 列表
                                </button>
                                <button type="button" class="editor-btn" onclick="formatText('privacyContent', 'quote')">
                                    <i class="fas fa-quote-right"></i> 引用
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label for="privacyContent"><i class="fas fa-file-alt"></i> 政策内容</label>
                                <textarea id="privacyContent" rows="10" placeholder="在此编辑隐私政策内容..."></textarea>
                                <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
                                    支持 HTML 标签，如 &lt;h3&gt;, &lt;p&gt;, &lt;strong&gt;, &lt;em&gt;, &lt;a&gt;, &lt;ul&gt;, &lt;li&gt; 等
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>页面状态</label>
                                <div class="toggle-switch">
                                    <label class="toggle-container">
                                        <input type="checkbox" id="privacyEnabled" class="toggle-checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" id="privacyStatusLabel">已启用 (公开访问)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-area">
                            <h4>预览效果：</h4>
                            <div class="preview-content" id="privacyPreview">
                                内容将在这里预览...
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('privacy')">
                                <i class="fas fa-save"></i> 保存隐私政策
                            </button>
                            <button class="admin-btn btn-secondary" onclick="previewContent('privacy')">
                                <i class="fas fa-eye"></i> 更新预览
                            </button>
                            <a href="../privacy.html" target="_blank" class="admin-btn btn-info">
                                <i class="fas fa-external-link-alt"></i> 查看页面
                            </a>
                        </div>
                    </div>
                    
                    <!-- 使用条款 -->
                    <div class="config-section" id="terms-of-service-section">
                        <div class="section-header">
                            <h2><i class="fas fa-file-contract"></i> 使用条款</h2>
                            <p>编辑网站使用条款内容</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="termsTitle"><i class="fas fa-heading"></i> 页面标题</label>
                                <input type="text" id="termsTitle" placeholder="使用条款">
                            </div>
                            
                            <!-- 快捷HTML标签 -->
                            <div class="quick-tags">
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'h3')">h3标题</button>
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'p')">段落</button>
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'strong')">加粗</button>
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'em')">斜体</button>
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'ul')">列表</button>
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'li')">列表项</button>
                                <button type="button" class="tag-btn" onclick="insertTag('termsContent', 'a')">链接</button>
                            </div>
                            
                            <div class="form-group">
                                <label for="termsContent"><i class="fas fa-file-alt"></i> 条款内容</label>
                                <textarea id="termsContent" rows="10" placeholder="在此编辑使用条款内容..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>页面状态</label>
                                <div class="toggle-switch">
                                    <label class="toggle-container">
                                        <input type="checkbox" id="termsEnabled" class="toggle-checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" id="termsStatusLabel">已启用 (公开访问)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-area">
                            <h4>预览效果：</h4>
                            <div class="preview-content" id="termsPreview">
                                内容将在这里预览...
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('terms')">
                                <i class="fas fa-save"></i> 保存使用条款
                            </button>
                            <button class="admin-btn btn-secondary" onclick="previewContent('terms')">
                                <i class="fas fa-eye"></i> 更新预览
                            </button>
                            <a href="../terms.html" target="_blank" class="admin-btn btn-info">
                                <i class="fas fa-external-link-alt"></i> 查看页面
                            </a>
                        </div>
                    </div>
                    
                    <!-- 版权声明 -->
                    <div class="config-section" id="copyright-section">
                        <div class="section-header">
                            <h2><i class="fas fa-copyright"></i> 版权声明</h2>
                            <p>编辑网站版权声明内容</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="copyrightTitle"><i class="fas fa-heading"></i> 页面标题</label>
                                <input type="text" id="copyrightTitle" placeholder="版权声明">
                            </div>
                            
                            <!-- 快捷HTML标签 -->
                            <div class="quick-tags">
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'h3')">h3标题</button>
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'p')">段落</button>
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'strong')">加粗</button>
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'em')">斜体</button>
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'ul')">列表</button>
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'li')">列表项</button>
                                <button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'a')">链接</button>
                            </div>
                            
                            <div class="form-group">
                                <label for="copyrightContent"><i class="fas fa-file-alt"></i> 声明内容</label>
                                <textarea id="copyrightContent" rows="10" placeholder="在此编辑版权声明内容..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>页面状态</label>
                                <div class="toggle-switch">
                                    <label class="toggle-container">
                                        <input type="checkbox" id="copyrightEnabled" class="toggle-checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" id="copyrightStatusLabel">已启用 (公开访问)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-area">
                            <h4>预览效果：</h4>
                            <div class="preview-content" id="copyrightPreview">
                                内容将在这里预览...
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('copyright')">
                                <i class="fas fa-save"></i> 保存版权声明
                            </button>
                            <button class="admin-btn btn-secondary" onclick="previewContent('copyright')">
                                <i class="fas fa-eye"></i> 更新预览
                            </button>
                            <a href="../copyright.html" target="_blank" class="admin-btn btn-info">
                                <i class="fas fa-external-link-alt"></i> 查看页面
                            </a>
                        </div>
                    </div>
                    
                    <!-- 社交链接 -->
                    <div class="config-section" id="social-links-section">
                        <div class="section-header">
                            <h2><i class="fas fa-share-alt"></i> 社交链接</h2>
                            <p>配置社交媒体的链接地址</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="githubUrl"><i class="fab fa-github"></i> GitHub</label>
                                <input type="url" id="githubUrl" placeholder="https://github.com/yourusername">
                            </div>
                            
                            <div class="form-group">
                                <label for="weiboUrl"><i class="fab fa-weibo"></i> 微博</label>
                                <input type="url" id="weiboUrl" placeholder="https://weibo.com/yourprofile">
                            </div>
                            
                            <div class="form-group">
                                <label for="zhihuUrl"><i class="fab fa-zhihu"></i> 知乎</label>
                                <input type="url" id="zhihuUrl" placeholder="https://www.zhihu.com/people/yourprofile">
                            </div>
                            
                            <div class="form-group">
                                <label for="linkedinUrl"><i class="fab fa-linkedin"></i> LinkedIn</label>
                                <input type="url" id="linkedinUrl" placeholder="https://linkedin.com/in/yourprofile">
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('social')">
                                <i class="fas fa-save"></i> 保存社交链接
                            </button>
                            <button class="admin-btn btn-secondary" onclick="resetCurrentSection('social')">
                                <i class="fas fa-undo"></i> 重置
                            </button>
                        </div>
                    </div>
                    
                    <!-- 新增：导航栏配置 -->
                    <div class="config-section" id="navigation-section">
                        <div class="section-header">
                            <h2><i class="fas fa-bars"></i> 导航栏配置</h2>
                            <p>管理网站导航菜单项</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="navItems"><i class="fas fa-list"></i> 导航菜单项</label>
                                <div id="navItemsContainer">
                                    <!-- 动态生成的导航项表单 -->
                                </div>
                                <button type="button" class="admin-btn btn-secondary" onclick="addNavItem()" style="margin-top: 10px;">
                                    <i class="fas fa-plus"></i> 添加菜单项
                                </button>
                            </div>
                            
                            <div class="preview-area">
                                <h4>导航栏预览：</h4>
                                <div class="preview-content" id="navPreview">
                                    <!-- 预览将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('navigation')">
                                <i class="fas fa-save"></i> 保存导航栏配置
                            </button>
                            <button class="admin-btn btn-secondary" onclick="previewNavigation()">
                                <i class="fas fa-eye"></i> 更新预览
                            </button>
                        </div>
                    </div>
                    
                    <!-- 新增：页脚配置 -->
                    <div class="config-section" id="footer-section">
                        <div class="section-header">
                            <h2><i class="fas fa-shoe-prints"></i> 页脚配置</h2>
                            <p>管理网站页脚内容</p>
                        </div>
                        
                        <div class="compact-form">
                            <div class="form-group">
                                <label for="footerDescription"><i class="fas fa-align-left"></i> 页脚描述</label>
                                <textarea id="footerDescription" rows="3" placeholder="在页脚显示的网站描述"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="footerCopyright"><i class="fas fa-copyright"></i> 版权信息</label>
                                <input type="text" id="footerCopyright" placeholder="例如：© 2026 zcfi.cn 版权所有">
                            </div>
                            
                            <div class="preview-area">
                                <h4>页脚预览：</h4>
                                <div class="preview-content" id="footerPreview">
                                    <!-- 预览将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-actions">
                            <button class="admin-btn btn-primary" onclick="saveCurrentSection('footer')">
                                <i class="fas fa-save"></i> 保存页脚配置
                            </button>
                            <button class="admin-btn btn-secondary" onclick="previewFooter()">
                                <i class="fas fa-eye"></i> 更新预览
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="admin-footer">
                <p>© 2026 zcfi.cn 配置管理系统</p>
                <p style="margin-top: 10px; font-size: 13px; color: #6c757d;">
                    注意：保存的配置将同步到GitHub Gist，网站前端会实时加载最新配置。
                </p>
            </div>
        </div>
    </div>

    <!-- 使用公共弹窗 -->
    <div class="custom-modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-question-circle"></i>
            </div>
            <div class="modal-title">确认保存</div>
            <div class="modal-message" id="confirmMessage">确定要保存当前配置吗？这将覆盖现有的配置数据。</div>
            <div class="modal-buttons">
                <button class="modal-btn btn-secondary" id="cancelSaveBtn">取消</button>
                <button class="modal-btn btn-primary" id="confirmSaveBtn">确认保存</button>
            </div>
        </div>
    </div>

    <!-- 结果弹窗 -->
    <div class="custom-modal" id="resultModal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-info-circle" id="resultIcon"></i>
            </div>
            <div class="modal-title" id="resultTitle">操作结果</div>
            <div class="modal-message" id="resultMessage">操作已完成</div>
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" id="closeResultBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- 加载弹窗 -->
    <div class="custom-modal" id="loadingModal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-spinner loading-spinner"></i>
            </div>
            <div class="modal-title">处理中</div>
            <div class="modal-message" id="loadingMessage">正在处理您的请求，请稍候...</div>
        </div>
    </div>

    <script>
        // 安全验证
        if (!sessionStorage.getItem('admin_verified') || !sessionStorage.getItem('admin_token')) {
            alert('❌ 未授权访问！请通过后台首页登录。');
            window.location.href = 'index.html';
        }
        
        // 全局配置
        const CONFIG_GIST_ID = '983bb7371ddb439a2fcbfb4885e34d14';
        const CONFIG_GIST_URL = `https://api.github.com/gists/${CONFIG_GIST_ID}`;
        const CONFIG_RAW_URL = `https://gist.githubusercontent.com/xiao305/${CONFIG_GIST_ID}/raw/config.json`;
        const token = sessionStorage.getItem('admin_token');
        
        let currentConfigData = {};
        let currentSection = 'site-info';
        let isSaving = false; // 防止重复提交
        let retryCount = 0; // 重试次数
        const MAX_RETRIES = 3; // 最大重试次数
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            initEventListeners();
            initToggleSwitches();
            loadConfigData();
        });
        
        // 初始化导航
        function initNavigation() {
            document.querySelectorAll('.config-nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 更新导航状态
                    document.querySelectorAll('.config-nav a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 获取目标部分
                    const targetId = this.getAttribute('href').substring(1);
                    
                    // 隐藏所有部分
                    document.querySelectorAll('.config-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // 显示目标部分
                    const targetSection = document.getElementById(`${targetId}-section`);
                    if (targetSection) {
                        targetSection.classList.add('active');
                        currentSection = targetId;
                    }
                });
            });
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            // 主按钮
            document.getElementById('refreshConfigBtn').addEventListener('click', loadConfigData);
            document.getElementById('backupConfigBtn').addEventListener('click', backupConfig);
            
            // 弹窗按钮
            document.getElementById('cancelSaveBtn').addEventListener('click', closeConfirmModal);
            document.getElementById('confirmSaveBtn').addEventListener('click', executeSave);
            document.getElementById('closeResultBtn').addEventListener('click', closeResultModal);
            
            // 实时预览
            document.getElementById('privacyContent').addEventListener('input', function() {
                previewContent('privacy');
            });
            
            document.getElementById('termsContent').addEventListener('input', function() {
                previewContent('terms');
            });
            
            document.getElementById('copyrightContent').addEventListener('input', function() {
                previewContent('copyright');
            });
        }
        
        // 初始化开关
        function initToggleSwitches() {
            // 隐私政策开关
            document.getElementById('privacyEnabled').addEventListener('change', function() {
                document.getElementById('privacyStatusLabel').textContent = 
                    this.checked ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
            });
            
            // 使用条款开关
            document.getElementById('termsEnabled').addEventListener('change', function() {
                document.getElementById('termsStatusLabel').textContent = 
                    this.checked ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
            });
            
            // 版权声明开关
            document.getElementById('copyrightEnabled').addEventListener('change', function() {
                document.getElementById('copyrightStatusLabel').textContent = 
                    this.checked ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
            });
        }
        
        // 加载配置数据
        async function loadConfigData() {
            try {
                showLoading('正在从服务器获取最新配置...');
                
                const timestamp = new Date().getTime();
                const response = await fetch(`${CONFIG_RAW_URL}?t=${timestamp}`);
                
                if (!response.ok) {
                    // 如果Gist不存在或为空，使用默认配置
                    console.warn('配置Gist不存在或为空，使用默认配置');
                    currentConfigData = getDefaultConfig();
                    populateFormWithConfig(currentConfigData);
                    hideLoading();
                    showResult('info', '提示', '使用默认配置，请保存以创建配置文件。');
                    return;
                }
                
                const data = await response.json();
                currentConfigData = data;
                populateFormWithConfig(data);
                hideLoading();
                showResult('success', '刷新成功', '配置数据已成功加载。');
                
            } catch (error) {
                console.error('加载配置失败:', error);
                currentConfigData = getDefaultConfig();
                populateFormWithConfig(currentConfigData);
                hideLoading();
                showResult('error', '加载失败', '无法加载配置，使用默认设置。');
            }
        }
        
        // 获取默认配置
        function getDefaultConfig() {
            return {
                site: {
                    name: 'zcfi.cn',
                    description: '个人网站和作品展示平台',
                    keywords: '个人网站,技术博客,作品展示',
                    adminEmail: 'admin@zcfi.cn',
                    lastUpdated: new Date().toISOString()
                },
                privacy: {
                    title: '隐私政策',
                    content: `<h3>1. 信息收集</h3>
<p>本站为个人非商业网站，不主动收集用户任何个人信息。</p>
<h3>2. 数据安全</h3>
<p>所有通过表单提交的数据将通过 HTTPS 加密传输。</p>
<h3>3. 联系我们</h3>
<p>如有任何隐私相关疑问，请通过联系页面与我沟通。</p>`,
                    enabled: true,
                    lastUpdated: new Date().toISOString()
                },
                terms: {
                    title: '使用条款',
                    content: `<h3>1. 接受条款</h3>
<p>通过访问和使用本网站，您同意遵守以下使用条款。</p>
<h3>2. 网站内容</h3>
<p>本网站所有内容均为原创或已获得合法授权，受版权法保护。</p>
<h3>3. 免责声明</h3>
<p>本网站按"现状"提供，不提供任何形式的保证。</p>`,
                    enabled: true,
                    lastUpdated: new Date().toISOString()
                },
                copyright: {
                    title: '版权声明',
                    content: `<h3>1. 版权归属</h3>
<p>本网站的所有原创内容均归网站所有者所有。</p>
<h3>2. 使用许可</h3>
<p>允许个人用户出于学习、研究目的下载、保存和参考本网站内容。</p>
<h3>3. 禁止行为</h3>
<p>未经授权，严禁复制、转载或重新发布本网站内容。</p>`,
                    enabled: true,
                    lastUpdated: new Date().toISOString()
                },
                social: {
                    github: 'https://github.com',
                    weibo: 'https://weibo.com',
                    zhihu: 'https://zhihu.com',
                    linkedin: 'https://linkedin.com',
                    lastUpdated: new Date().toISOString()
                },
                navigation: {
                    items: [
                        { name: '首页', url: './', order: 1 },
                        { name: '作品集', url: 'portfolio.html', order: 2 },
                        { name: '博客', url: 'blog.html', order: 3 },
                        { name: '联系我', url: 'contact.html', order: 4 }
                    ],
                    lastUpdated: new Date().toISOString()
                },
                footer: {
                    description: '个人网站和作品展示平台',
                    copyright: '© 2026 zcfi.cn 版权所有',
                    lastUpdated: new Date().toISOString()
                }
            };
        }
        
        // 填充表单数据
        function populateFormWithConfig(config) {
            // 网站信息
            if (config.site) {
                document.getElementById('siteName').value = config.site.name || '';
                document.getElementById('siteDescription').value = config.site.description || '';
                document.getElementById('siteKeywords').value = config.site.keywords || '';
                document.getElementById('adminEmail').value = config.site.adminEmail || '';
            }
            
            // 隐私政策
            if (config.privacy) {
                document.getElementById('privacyTitle').value = config.privacy.title || '';
                document.getElementById('privacyContent').value = config.privacy.content || '';
                document.getElementById('privacyEnabled').checked = config.privacy.enabled !== false;
                document.getElementById('privacyStatusLabel').textContent = 
                    config.privacy.enabled !== false ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
                previewContent('privacy');
            }
            
            // 使用条款
            if (config.terms) {
                document.getElementById('termsTitle').value = config.terms.title || '';
                document.getElementById('termsContent').value = config.terms.content || '';
                document.getElementById('termsEnabled').checked = config.terms.enabled !== false;
                document.getElementById('termsStatusLabel').textContent = 
                    config.terms.enabled !== false ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
                previewContent('terms');
            }
            
            // 版权声明
            if (config.copyright) {
                document.getElementById('copyrightTitle').value = config.copyright.title || '';
                document.getElementById('copyrightContent').value = config.copyright.content || '';
                document.getElementById('copyrightEnabled').checked = config.copyright.enabled !== false;
                document.getElementById('copyrightStatusLabel').textContent = 
                    config.copyright.enabled !== false ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
                previewContent('copyright');
            }
            
            // 社交链接
            if (config.social) {
                document.getElementById('githubUrl').value = config.social.github || '';
                document.getElementById('weiboUrl').value = config.social.weibo || '';
                document.getElementById('zhihuUrl').value = config.social.zhihu || '';
                document.getElementById('linkedinUrl').value = config.social.linkedin || '';
            }
            
            // 导航栏配置
            if (config.navigation) {
                populateNavigationForm(config.navigation.items || []);
                previewNavigation();
            }
            
            // 页脚配置
            if (config.footer) {
                document.getElementById('footerDescription').value = config.footer.description || '';
                document.getElementById('footerCopyright').value = config.footer.copyright || '';
                previewFooter();
            }
        }
        
        // 导航栏表单处理函数
        function populateNavigationForm(items) {
            const container = document.getElementById('navItemsContainer');
            container.innerHTML = '';
            
            // 按order排序
            const sortedItems = [...items].sort((a, b) => (a.order || 0) - (b.order || 0));
            
            sortedItems.forEach((item, index) => {
                const itemId = `navItem_${index}`;
                const itemHtml = `
                    <div class="nav-item-row" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <input type="hidden" name="navOrder" value="${item.order || index + 1}">
                        <input type="text" class="nav-item-name" placeholder="菜单名称" 
                               value="${escapeHtml(item.name || '')}" 
                               style="flex: 1; padding: 8px;">
                        <input type="text" class="nav-item-url" placeholder="链接地址" 
                               value="${escapeHtml(item.url || '')}" 
                               style="flex: 2; padding: 8px;">
                        <button type="button" class="admin-btn btn-danger btn-sm" 
                                onclick="removeNavItem(this)" style="padding: 8px 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button type="button" class="admin-btn btn-secondary btn-sm" 
                                onclick="moveNavItemUp(this)" style="padding: 8px 12px;">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                        <button type="button" class="admin-btn btn-secondary btn-sm" 
                                onclick="moveNavItemDown(this)" style="padding: 8px 12px;">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                    </div>
                `;
                container.innerHTML += itemHtml;
            });
        }
        
        // 添加导航项
        function addNavItem() {
            const container = document.getElementById('navItemsContainer');
            const items = container.querySelectorAll('.nav-item-row');
            const nextOrder = items.length + 1;
            
            const itemHtml = `
                <div class="nav-item-row" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                    <input type="hidden" name="navOrder" value="${nextOrder}">
                    <input type="text" class="nav-item-name" placeholder="菜单名称" value="" style="flex: 1; padding: 8px;">
                    <input type="text" class="nav-item-url" placeholder="链接地址" value="" style="flex: 2; padding: 8px;">
                    <button type="button" class="admin-btn btn-danger btn-sm" 
                            onclick="removeNavItem(this)" style="padding: 8px 12px;">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button type="button" class="admin-btn btn-secondary btn-sm" 
                            onclick="moveNavItemUp(this)" style="padding: 8px 12px;">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button type="button" class="admin-btn btn-secondary btn-sm" 
                            onclick="moveNavItemDown(this)" style="padding: 8px 12px;">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
            `;
            container.innerHTML += itemHtml;
            previewNavigation();
        }
        
        // 移除导航项
        function removeNavItem(button) {
            const row = button.closest('.nav-item-row');
            row.remove();
            updateNavItemOrders();
            previewNavigation();
        }
        
        // 上移导航项
        function moveNavItemUp(button) {
            const row = button.closest('.nav-item-row');
            const prevRow = row.previousElementSibling;
            
            if (prevRow && prevRow.classList.contains('nav-item-row')) {
                row.parentNode.insertBefore(row, prevRow);
                updateNavItemOrders();
                previewNavigation();
            }
        }
        
        // 下移导航项
        function moveNavItemDown(button) {
            const row = button.closest('.nav-item-row');
            const nextRow = row.nextElementSibling;
            
            if (nextRow && nextRow.classList.contains('nav-item-row')) {
                row.parentNode.insertBefore(nextRow, row);
                updateNavItemOrders();
                previewNavigation();
            }
        }
        
        // 更新导航项顺序
        function updateNavItemOrders() {
            const items = document.querySelectorAll('.nav-item-row');
            items.forEach((item, index) => {
                const orderInput = item.querySelector('input[name="navOrder"]');
                if (orderInput) {
                    orderInput.value = index + 1;
                }
            });
        }
        
        // 预览导航栏
        function previewNavigation() {
            const previewElement = document.getElementById('navPreview');
            const items = [];
            
            document.querySelectorAll('.nav-item-row').forEach(row => {
                const nameInput = row.querySelector('.nav-item-name');
                const urlInput = row.querySelector('.nav-item-url');
                const orderInput = row.querySelector('input[name="navOrder"]');
                
                if (nameInput && urlInput && nameInput.value && urlInput.value) {
                    items.push({
                        name: nameInput.value,
                        url: urlInput.value,
                        order: parseInt(orderInput?.value || '0')
                    });
                }
            });
            
            // 按order排序
            const sortedItems = [...items].sort((a, b) => a.order - b.order);
            
            if (sortedItems.length === 0) {
                previewElement.innerHTML = '<p style="color: #999;">暂无导航菜单项</p>';
                return;
            }
            
            const previewHtml = sortedItems.map(item => 
                `<a href="${escapeHtml(item.url)}" style="display: inline-block; margin-right: 15px; color: #4a6fa5; text-decoration: none;">${escapeHtml(item.name)}</a>`
            ).join('');
            
            previewElement.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <span style="font-weight: bold; color: #4a6fa5;">zcfi.cn</span>
                        <div style="display: flex; gap: 15px;">
                            ${previewHtml}
                        </div>
                        <button style="background: none; border: none; color: #4a6fa5; font-size: 20px; cursor: pointer;">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 预览页脚
        function previewFooter() {
            const previewElement = document.getElementById('footerPreview');
            const description = document.getElementById('footerDescription').value || '';
            const copyright = document.getElementById('footerCopyright').value || '';
            
            previewElement.innerHTML = `
                <div style="background: #333344; color: white; padding: 30px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">zcfi.cn</div>
                            <p style="color: #aaa;">${description || '网站描述'}</p>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 10px;">快速链接</h4>
                            <ul style="list-style: none; padding: 0; color: #aaa;">
                                <li><a href="./" style="color: #aaa; text-decoration: none;">首页</a></li>
                                <li><a href="portfolio.html" style="color: #aaa; text-decoration: none;">作品集</a></li>
                                <li><a href="blog.html" style="color: #aaa; text-decoration: none;">博客</a></li>
                                <li><a href="contact.html" style="color: #aaa; text-decoration: none;">联系我</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="border-top: 1px solid #444; padding-top: 15px; text-align: center; color: #aaa;">
                        ${copyright || '© 2026 zcfi.cn 版权所有'}
                    </div>
                </div>
            `;
        }
        
        // 保存当前部分
        function saveCurrentSection(section) {
            if (isSaving) {
                showResult('info', '请稍候', '正在保存中，请勿重复提交。');
                return;
            }
            
            // 收集当前部分的数据
            const sectionData = {};
            
            switch(section) {
                case 'site-info':
                    const siteName = document.getElementById('siteName').value.trim();
                    const siteDescription = document.getElementById('siteDescription').value.trim();
                    
                    if (!siteName || !siteDescription) {
                        showResult('error', '输入错误', '请填写网站名称和描述');
                        return;
                    }
                    
                    sectionData.site = {
                        name: siteName,
                        description: siteDescription,
                        keywords: document.getElementById('siteKeywords').value.trim(),
                        adminEmail: document.getElementById('adminEmail').value.trim(),
                        lastUpdated: new Date().toISOString()
                    };
                    break;
                    
                case 'privacy':
                    const privacyTitle = document.getElementById('privacyTitle').value.trim();
                    const privacyContent = document.getElementById('privacyContent').value.trim();
                    
                    if (!privacyTitle || !privacyContent) {
                        showResult('error', '输入错误', '请填写页面标题和内容');
                        return;
                    }
                    
                    sectionData.privacy = {
                        title: privacyTitle,
                        content: privacyContent,
                        enabled: document.getElementById('privacyEnabled').checked,
                        lastUpdated: new Date().toISOString()
                    };
                    break;
                    
                case 'terms':
                    const termsTitle = document.getElementById('termsTitle').value.trim();
                    const termsContent = document.getElementById('termsContent').value.trim();
                    
                    if (!termsTitle || !termsContent) {
                        showResult('error', '输入错误', '请填写页面标题和内容');
                        return;
                    }
                    
                    sectionData.terms = {
                        title: termsTitle,
                        content: termsContent,
                        enabled: document.getElementById('termsEnabled').checked,
                        lastUpdated: new Date().toISOString()
                    };
                    break;
                    
                case 'copyright':
                    const copyrightTitle = document.getElementById('copyrightTitle').value.trim();
                    const copyrightContent = document.getElementById('copyrightContent').value.trim();
                    
                    if (!copyrightTitle || !copyrightContent) {
                        showResult('error', '输入错误', '请填写页面标题和内容');
                        return;
                    }
                    
                    sectionData.copyright = {
                        title: copyrightTitle,
                        content: copyrightContent,
                        enabled: document.getElementById('copyrightEnabled').checked,
                        lastUpdated: new Date().toISOString()
                    };
                    break;
                    
                case 'social':
                    sectionData.social = {
                        github: document.getElementById('githubUrl').value.trim(),
                        weibo: document.getElementById('weiboUrl').value.trim(),
                        zhihu: document.getElementById('zhihuUrl').value.trim(),
                        linkedin: document.getElementById('linkedinUrl').value.trim(),
                        lastUpdated: new Date().toISOString()
                    };
                    break;
                    
                case 'navigation':
                    const navItems = [];
                    document.querySelectorAll('.nav-item-row').forEach(row => {
                        const nameInput = row.querySelector('.nav-item-name');
                        const urlInput = row.querySelector('.nav-item-url');
                        const orderInput = row.querySelector('input[name="navOrder"]');
                        
                        if (nameInput && urlInput && nameInput.value && urlInput.value) {
                            navItems.push({
                                name: nameInput.value,
                                url: urlInput.value,
                                order: parseInt(orderInput?.value || '0')
                            });
                        }
                    });
                    
                    if (navItems.length === 0) {
                        showResult('error', '输入错误', '请至少添加一个导航菜单项');
                        return;
                    }
                    
                    sectionData.navigation = {
                        items: navItems,
                        lastUpdated: new Date().toISOString()
                    };
                    break;
                    
                case 'footer':
                    const footerDescription = document.getElementById('footerDescription').value.trim();
                    const footerCopyright = document.getElementById('footerCopyright').value.trim();
                    
                    if (!footerDescription || !footerCopyright) {
                        showResult('error', '输入错误', '请填写页脚描述和版权信息');
                        return;
                    }
                    
                    sectionData.footer = {
                        description: footerDescription,
                        copyright: footerCopyright,
                        lastUpdated: new Date().toISOString()
                    };
                    break;
            }
            
            // 显示确认弹窗
            document.getElementById('confirmMessage').textContent = `确定要保存${getSectionName(section)}吗？`;
            document.getElementById('confirmSaveBtn').dataset.section = section;
            document.getElementById('confirmSaveBtn').dataset.sectionData = JSON.stringify(sectionData);
            showModal('confirmModal');
        }
        
        // 执行保存
        async function executeSave() {
            if (isSaving) {
                showResult('info', '请稍候', '正在保存中，请勿重复提交。');
                return;
            }
            
            const section = this.dataset.section;
            const sectionData = JSON.parse(this.dataset.sectionData);
            
            isSaving = true;
            retryCount = 0;
            
            try {
                showLoading('正在保存配置...');
                
                // 更新当前配置数据
                Object.assign(currentConfigData, sectionData);
                
                // 保存到Gist，带有重试机制
                await saveConfigToGistWithRetry(currentConfigData);
                
                hideLoading();
                showResult('success', '保存成功', `${getSectionName(section)}已成功保存。`);
                closeConfirmModal();
                
            } catch (error) {
                hideLoading();
                showResult('error', '保存失败', error.message);
            } finally {
                isSaving = false;
            }
        }
        
        // 带有重试机制的保存
        async function saveConfigToGistWithRetry(configData, retry = 0) {
            try {
                return await saveConfigToGist(configData);
            } catch (error) {
                if (retry < MAX_RETRIES) {
                    console.log(`保存失败，第${retry + 1}次重试...`);
                    await delay(1000 * (retry + 1)); // 延迟重试
                    return await saveConfigToGistWithRetry(configData, retry + 1);
                } else {
                    throw error;
                }
            }
        }
        
        // 延迟函数
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // 保存到Gist（修复CORS问题）
        async function saveConfigToGist(configData) {
            try {
                // 使用代理绕过CORS限制
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const encodedUrl = encodeURIComponent(CONFIG_GIST_URL);
                
                // 首先尝试通过API获取现有Gist
                const response = await fetch(proxyUrl + encodedUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let gistExists = response.ok;
                
                // 准备更新数据
                const updateData = {
                    description: '网站配置数据',
                    files: {
                        'config.json': {
                            content: JSON.stringify(configData, null, 2)
                        }
                    }
                };
                
                let updateResponse;
                
                if (gistExists) {
                    // 更新现有Gist
                    updateResponse = await fetch(proxyUrl + encodeURIComponent(CONFIG_GIST_URL), {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });
                } else {
                    // 创建新Gist
                    updateResponse = await fetch(proxyUrl + encodeURIComponent('https://api.github.com/gists'), {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });
                }
                
                if (!updateResponse.ok) {
                    const errorText = await updateResponse.text();
                    console.error('GitHub API错误:', errorText);
                    throw new Error(`保存失败: ${updateResponse.status} ${updateResponse.statusText}`);
                }
                
                return true;
                
            } catch (error) {
                console.error('保存配置到Gist失败:', error);
                // 如果代理失败，尝试直接请求（可能会被CORS阻止）
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    try {
                        return await saveConfigToGistDirect(configData);
                    } catch (directError) {
                        throw new Error('网络错误，请检查Token权限或稍后重试');
                    }
                }
                throw error;
            }
        }
        
        // 直接保存到Gist（可能被CORS阻止）
        async function saveConfigToGistDirect(configData) {
            const response = await fetch(CONFIG_GIST_URL, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            let gistExists = response.ok;
            
            const updateData = {
                description: '网站配置数据',
                files: {
                    'config.json': {
                        content: JSON.stringify(configData, null, 2)
                    }
                }
            };
            
            let updateResponse;
            
            if (gistExists) {
                updateResponse = await fetch(CONFIG_GIST_URL, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
            } else {
                updateResponse = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
            }
            
            if (!updateResponse.ok) {
                throw new Error(`保存失败: ${updateResponse.status} ${updateResponse.statusText}`);
            }
            
            return true;
        }
        
        // 备份配置
        async function backupConfig() {
            try {
                showLoading('正在创建备份...');
                
                // 收集当前配置数据
                const backupData = {
                    site: {
                        name: document.getElementById('siteName').value,
                        description: document.getElementById('siteDescription').value,
                        keywords: document.getElementById('siteKeywords').value,
                        adminEmail: document.getElementById('adminEmail').value
                    },
                    privacy: {
                        title: document.getElementById('privacyTitle').value,
                        content: document.getElementById('privacyContent').value,
                        enabled: document.getElementById('privacyEnabled').checked
                    },
                    terms: {
                        title: document.getElementById('termsTitle').value,
                        content: document.getElementById('termsContent').value,
                        enabled: document.getElementById('termsEnabled').checked
                    },
                    copyright: {
                        title: document.getElementById('copyrightTitle').value,
                        content: document.getElementById('copyrightContent').value,
                        enabled: document.getElementById('copyrightEnabled').checked
                    },
                    social: {
                        github: document.getElementById('githubUrl').value,
                        weibo: document.getElementById('weiboUrl').value,
                        zhihu: document.getElementById('zhihuUrl').value,
                        linkedin: document.getElementById('linkedinUrl').value
                    },
                    navigation: {
                        items: []
                    },
                    footer: {
                        description: document.getElementById('footerDescription').value,
                        copyright: document.getElementById('footerCopyright').value
                    }
                };
                
                // 收集导航项
                document.querySelectorAll('.nav-item-row').forEach(row => {
                    const nameInput = row.querySelector('.nav-item-name');
                    const urlInput = row.querySelector('.nav-item-url');
                    const orderInput = row.querySelector('input[name="navOrder"]');
                    
                    if (nameInput && urlInput && nameInput.value && urlInput.value) {
                        backupData.navigation.items.push({
                            name: nameInput.value,
                            url: urlInput.value,
                            order: parseInt(orderInput?.value || '0')
                        });
                    }
                });
                
                // 创建备份文件
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const backupBlob = new Blob(
                    [JSON.stringify(backupData, null, 2)], 
                    { type: 'application/json' }
                );
                
                // 下载备份文件
                const backupUrl = URL.createObjectURL(backupBlob);
                const downloadLink = document.createElement('a');
                downloadLink.href = backupUrl;
                downloadLink.download = `config-backup-${timestamp}.json`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                URL.revokeObjectURL(backupUrl);
                
                hideLoading();
                showResult('success', '备份成功', '配置文件已下载到您的设备。');
                
            } catch (error) {
                hideLoading();
                showResult('error', '备份失败', error.message);
            }
        }
        
        // 重置当前部分
        function resetCurrentSection(section) {
            if (confirm(`确定要重置${getSectionName(section)}吗？所有未保存的更改将丢失。`)) {
                // 重新从当前配置数据填充表单
                populateSectionFromConfig(section);
            }
        }
        
        // 从配置数据填充部分
        function populateSectionFromConfig(section) {
            switch(section) {
                case 'site-info':
                    if (currentConfigData.site) {
                        document.getElementById('siteName').value = currentConfigData.site.name || '';
                        document.getElementById('siteDescription').value = currentConfigData.site.description || '';
                        document.getElementById('siteKeywords').value = currentConfigData.site.keywords || '';
                        document.getElementById('adminEmail').value = currentConfigData.site.adminEmail || '';
                    }
                    break;
                    
                case 'privacy':
                    if (currentConfigData.privacy) {
                        document.getElementById('privacyTitle').value = currentConfigData.privacy.title || '';
                        document.getElementById('privacyContent').value = currentConfigData.privacy.content || '';
                        document.getElementById('privacyEnabled').checked = currentConfigData.privacy.enabled !== false;
                        previewContent('privacy');
                    }
                    break;
                    
                case 'terms':
                    if (currentConfigData.terms) {
                        document.getElementById('termsTitle').value = currentConfigData.terms.title || '';
                        document.getElementById('termsContent').value = currentConfigData.terms.content || '';
                        document.getElementById('termsEnabled').checked = currentConfigData.terms.enabled !== false;
                        previewContent('terms');
                    }
                    break;
                    
                case 'copyright':
                    if (currentConfigData.copyright) {
                        document.getElementById('copyrightTitle').value = currentConfigData.copyright.title || '';
                        document.getElementById('copyrightContent').value = currentConfigData.copyright.content || '';
                        document.getElementById('copyrightEnabled').checked = currentConfigData.copyright.enabled !== false;
                        previewContent('copyright');
                    }
                    break;
                    
                case 'social':
                    if (currentConfigData.social) {
                        document.getElementById('githubUrl').value = currentConfigData.social.github || '';
                        document.getElementById('weiboUrl').value = currentConfigData.social.weibo || '';
                        document.getElementById('zhihuUrl').value = currentConfigData.social.zhihu || '';
                        document.getElementById('linkedinUrl').value = currentConfigData.social.linkedin || '';
                    }
                    break;
                    
                case 'navigation':
                    if (currentConfigData.navigation) {
                        populateNavigationForm(currentConfigData.navigation.items || []);
                        previewNavigation();
                    }
                    break;
                    
                case 'footer':
                    if (currentConfigData.footer) {
                        document.getElementById('footerDescription').value = currentConfigData.footer.description || '';
                        document.getElementById('footerCopyright').value = currentConfigData.footer.copyright || '';
                        previewFooter();
                    }
                    break;
            }
        }
        
        // 预览内容
        function previewContent(type) {
            let content = '';
            let title = '';
            
            switch(type) {
                case 'privacy':
                    content = document.getElementById('privacyContent').value;
                    title = document.getElementById('privacyTitle').value || '隐私政策';
                    break;
                case 'terms':
                    content = document.getElementById('termsContent').value;
                    title = document.getElementById('termsTitle').value || '使用条款';
                    break;
                case 'copyright':
                    content = document.getElementById('copyrightContent').value;
                    title = document.getElementById('copyrightTitle').value || '版权声明';
                    break;
            }
            
            const previewElement = document.getElementById(`${type}Preview`);
            if (previewElement) {
                previewElement.innerHTML = `
                    <h3 style="color: #333; margin-bottom: 15px;">${title}</h3>
                    <div>${content || '<p style="color: #999;">暂无内容</p>'}</div>
                `;
            }
        }
        
        // 插入HTML标签
        function insertTag(textareaId, tag) {
            const textarea = document.getElementById(textareaId);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let formattedText = '';
            
            switch(tag) {
                case 'h3':
                    formattedText = `<h3>${selectedText || '小标题'}</h3>`;
                    break;
                case 'p':
                    formattedText = `<p>${selectedText || '段落内容'}</p>`;
                    break;
                case 'strong':
                    formattedText = `<strong>${selectedText || '加粗文本'}</strong>`;
                    break;
                case 'em':
                    formattedText = `<em>${selectedText || '斜体文本'}</em>`;
                    break;
                case 'ul':
                    formattedText = '<ul>\n  <li>列表项1</li>\n  <li>列表项2</li>\n</ul>';
                    break;
                case 'li':
                    formattedText = '<li>' + (selectedText || '列表项内容') + '</li>';
                    break;
                case 'a':
                    const url = prompt('请输入链接地址:', 'https://');
                    if (url) {
                        const linkText = selectedText || '链接文本';
                        formattedText = `<a href="${url}" target="_blank">${linkText}</a>`;
                    } else {
                        return;
                    }
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            
            // 重新聚焦并设置光标位置
            textarea.focus();
            textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
            
            // 触发输入事件以更新预览
            textarea.dispatchEvent(new Event('input'));
        }
        
        // 文本格式化工具
        function formatText(textareaId, format) {
            const textarea = document.getElementById(textareaId);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let formattedText = '';
            
            switch(format) {
                case 'bold':
                    formattedText = `<strong>${selectedText}</strong>`;
                    break;
                case 'italic':
                    formattedText = `<em>${selectedText}</em>`;
                    break;
                case 'underline':
                    formattedText = `<u>${selectedText}</u>`;
                    break;
                case 'link':
                    const url = prompt('请输入链接地址:', 'https://');
                    if (url) {
                        const linkText = selectedText || '链接文本';
                        formattedText = `<a href="${url}" target="_blank">${linkText}</a>`;
                    } else {
                        return;
                    }
                    break;
                case 'list':
                    const listItems = selectedText.split('\n').filter(item => item.trim());
                    if (listItems.length > 0) {
                        formattedText = '<ul>\n' + listItems.map(item => `  <li>${item}</li>`).join('\n') + '\n</ul>';
                    } else {
                        formattedText = '<ul>\n  <li>列表项1</li>\n  <li>列表项2</li>\n</ul>';
                    }
                    break;
                case 'quote':
                    formattedText = `<blockquote>${selectedText || '引用内容'}</blockquote>`;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            
            // 重新聚焦并设置光标位置
            textarea.focus();
            textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
            
            // 触发输入事件以更新预览
            textarea.dispatchEvent(new Event('input'));
        }
        
        // 获取部分名称
        function getSectionName(section) {
            const names = {
                'site-info': '网站信息',
                'privacy': '隐私政策',
                'terms': '使用条款',
                'copyright': '版权声明',
                'social': '社交链接',
                'navigation': '导航栏配置',
                'footer': '页脚配置'
            };
            return names[section] || '配置';
        }
        
        // 弹窗控制函数
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function closeConfirmModal() {
            hideModal('confirmModal');
        }
        
        function closeResultModal() {
            hideModal('resultModal');
        }
        
        function showLoading(message = '正在处理您的请求，请稍候...') {
            document.getElementById('loadingMessage').textContent = message;
            showModal('loadingModal');
        }
        
        function hideLoading() {
            hideModal('loadingModal');
        }
        
        function showResult(type, title, message) {
            const icon = document.getElementById('resultIcon');
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
                icon.style.color = '#28a745';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
                icon.style.color = '#dc3545';
            } else {
                icon.className = 'fas fa-info-circle';
                icon.style.color = '#4a6fa5';
            }
            
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultMessage').textContent = message;
            showModal('resultModal');
        }
        
        // HTML转义辅助函数
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 页面卸载时清除敏感信息
        window.addEventListener('beforeunload', () => {
            sessionStorage.removeItem('admin_token');
            sessionStorage.removeItem('admin_verified');
        });
    </script>
</body>
</html>
