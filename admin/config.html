<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>网站配置 | zcfi.cn</title>
<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg">
<link rel="icon" type="image/png" sizes="96x96" href="../favicon/favicon-96x96.png">
<link rel="icon" type="image/x-icon" href="../favicon/favicon.ico">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- 后台公共CSS -->
<link rel="stylesheet" href="assets/css/admin-common.css">
<style>
/* 配置管理特定样式 */
.config-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 30px;
}
.config-sidebar {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    height: fit-content;
}
.config-nav {
    list-style: none;
}
.config-nav li {
    margin-bottom: 5px;
}
.config-nav a {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    color: #495057;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: 500;
}
.config-nav a:hover {
    background: #e9ecef;
    color: #4a6fa5;
}
.config-nav a.active {
    background: #4a6fa5;
    color: white;
}
.config-nav i {
    font-size: 16px;
    width: 20px;
    text-align: center;
}
.config-content {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}
.config-section {
    display: none;
}
.config-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
.section-header {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}
.section-header h2 {
    color: #333;
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.section-header p {
    color: #6c757d;
    margin-top: 8px;
    font-size: 14px;
}
/* 紧凑的表单样式 */
.compact-form .form-group {
    margin-bottom: 15px;
}
.compact-form .form-group label {
    font-size: 14px;
    margin-bottom: 6px;
}
.compact-form input,
.compact-form textarea {
    padding: 10px 12px;
    font-size: 14px;
}
/* 开关控件 */
.toggle-switch {
    display: flex;
    align-items: center;
    gap: 10px;
}
.toggle-label {
    font-size: 14px;
    color: #495057;
}
.toggle-container {
    position: relative;
    width: 50px;
    height: 26px;
}
.toggle-checkbox {
    display: none;
}
.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}
.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}
.toggle-checkbox:checked + .toggle-slider {
    background-color: #4a6fa5;
}
.toggle-checkbox:checked + .toggle-slider:before {
    transform: translateX(24px);
}
/* 操作按钮组 */
.section-actions {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
    flex-wrap: wrap;
}
/* 预览区域 - 真实样式 */
.preview-area {
    margin-top: 20px;
    border-radius: 8px;
    overflow: hidden;
}
.preview-area h4 {
    padding: 15px;
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    color: #495057;
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}
.preview-content {
    padding: 20px;
    background: white;
}
/* 立即加载真实样式 */
.preview-content .preview-nav,
.preview-content .preview-footer {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}
/* 导航栏预览样式 - 与前端完全一致 */
.preview-nav {
    background: white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}
.preview-navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 0;
}
.preview-logo {
    font-size: 1.8rem;
    font-weight: 700;
    color: #4a6fa5;
    text-decoration: none;
    display: flex;
    align-items: center;
}
.preview-logo span {
    color: #4fc3a1;
}
.preview-nav-links {
    display: flex;
    list-style: none;
}
.preview-nav-links li {
    margin-left: 30px;
}
.preview-nav-links a {
    text-decoration: none;
    color: #333;
    font-weight: 500;
    position: relative;
}
.preview-nav-links a::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #4a6fa5;
    transition: all 0.3s ease;
}
.preview-nav-links a:hover::after {
    width: 100%;
}
.preview-mobile-menu-btn {
    display: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #4a6fa5;
    background: none;
    border: none;
    padding: 10px;
}
/* 页脚预览样式 - 与前端完全一致 */
.preview-footer {
    background-color: #333344;
    color: white;
    padding: 70px 0 30px;
}
.preview-footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 40px;
    margin-bottom: 50px;
}
.preview-footer-logo {
    font-size: 1.8rem;
    font-weight: 700;
    color: white;
    margin-bottom: 15px;
    display: inline-block;
    text-decoration: none;
}
.preview-footer-logo span {
    color: #4fc3a1;
}
.preview-footer-about p {
    color: #aaa;
    margin-bottom: 20px;
}
.preview-social-links {
    display: flex;
    gap: 15px;
}
.preview-social-links a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
}
.preview-social-links a:hover {
    background-color: #4fc3a1;
    transform: translateY(-3px);
}
.preview-footer-heading {
    font-size: 1.2rem;
    margin-bottom: 20px;
    color: white;
    position: relative;
}
.preview-footer-heading::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 40px;
    height: 2px;
    background-color: #4fc3a1;
}
.preview-footer-links ul {
    list-style: none;
    padding-left: 0;
}
.preview-footer-links li {
    margin-bottom: 10px;
}
.preview-footer-links a {
    color: #aaa;
    text-decoration: none;
    transition: all 0.3s ease;
}
.preview-footer-links a:hover {
    color: #4fc3a1;
    padding-left: 5px;
}
/* 合规声明 */
.preview-compliance {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 30px;
    text-align: center;
    font-size: 0.9rem;
    color: #aaa;
}
.preview-compliance p {
    margin-bottom: 10px;
}
.preview-compliance-links {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 15px;
}
.preview-compliance-links a {
    color: #aaa;
    text-decoration: none;
    transition: all 0.3s ease;
}
.preview-compliance-links a:hover {
    color: #4fc3a1;
}
/* 富文本编辑器样式 */
.editor-toolbar {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    flex-wrap: wrap;
}
.editor-btn {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
    color: #495057;
}
.editor-btn:hover {
    background: #f8f9fa;
    border-color: #4a6fa5;
    color: #4a6fa5;
}
.editor-btn i {
    font-size: 14px;
}
/* 快捷标签按钮组 */
.quick-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
}
.tag-btn {
    background: #e9ecef;
    border: none;
    border-radius: 4px;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    color: #495057;
}
.tag-btn:hover {
    background: #4a6fa5;
    color: white;
}
/* 刷新按钮区域 */
.refresh-section {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}
/* 新增：导航项表单样式 */
.nav-item-row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    align-items: center;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}
.nav-item-row input {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    font-size: 14px;
}
.nav-item-name {
    min-width: 120px;
}
.nav-item-url {
    min-width: 200px;
}
.btn-sm {
    padding: 8px 12px !important;
    font-size: 13px !important;
}
.homepage-item {
    background-color: #e9f7fe !important;
    border-color: #17a2b8 !important;
}
.homepage-item .btn-danger,
.homepage-item .btn-secondary {
    visibility: hidden;
}
/* 页脚配置表单 */
.footer-config-form .form-group {
    margin-bottom: 20px;
}
.footer-config-form label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}
.footer-config-form input,
.footer-config-form textarea {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    font-size: 14px;
}
.footer-config-form textarea {
    min-height: 80px;
    resize: vertical;
}
.footer-link-item {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    align-items: center;
}
.footer-link-item input {
    flex: 1;
}
.footer-links-container {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    background: #f8f9fa;
}
/* 修正：统一社交链接输入框样式 */
.social-links-config {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 12px;
    align-items: center;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    margin-bottom: 12px;
}
.social-icon-preview {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
    font-size: 16px;
    flex-shrink: 0;
}
.social-link-name {
    font-weight: 500;
    color: #495057;
    white-space: nowrap;
    min-width: 80px;
}
/* URL验证样式 */
.url-validation {
    margin-top: 5px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.url-valid {
    color: #28a745;
}
.url-invalid {
    color: #dc3545;
}
/* 全屏预览模态框 */
.fullscreen-preview-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 2000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}
.fullscreen-preview-modal.show {
    opacity: 1;
    visibility: visible;
}
.fullscreen-preview-container {
    width: 100%;
    max-width: 1200px;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 50px rgba(0,0,0,0.5);
}
.fullscreen-preview-header {
    background: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e9ecef;
}
.fullscreen-preview-title {
    font-weight: 600;
    color: #333;
}
.close-fullscreen-btn {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}
.close-fullscreen-btn:hover {
    background: #c82333;
    transform: scale(1.1);
}
.fullscreen-preview-content {
    padding: 20px;
}
/* 响应式设计 */
@media (max-width: 992px) {
    .config-layout {
        grid-template-columns: 1fr;
    }
    .config-sidebar {
        position: sticky;
        top: 20px;
        z-index: 100;
    }
    .config-nav {
        display: flex;
        overflow-x: auto;
        gap: 10px;
        padding-bottom: 10px;
    }
    .config-nav li {
        margin-bottom: 0;
        flex-shrink: 0;
    }
    .config-nav a {
        white-space: nowrap;
    }
}
@media (max-width: 768px) {
    .config-content {
        padding: 20px;
    }
    .section-actions {
        flex-direction: column;
    }
    .section-actions button {
        width: 100%;
    }
    .editor-toolbar {
        padding: 8px;
    }
    .editor-btn {
        padding: 6px 8px;
        font-size: 12px;
    }
    .nav-item-row {
        flex-direction: column;
        align-items: stretch;
    }
    .nav-item-row input {
        width: 100%;
    }
    /* 移动端菜单显示 */
    .preview-mobile-menu-btn {
        display: block;
    }
    .preview-nav-links {
        position: fixed;
        top: 80px;
        left: 0;
        width: 100%;
        background-color: white;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transform: translateY(-150%);
        transition: transform 0.3s ease;
        z-index: 999;
    }
    .preview-nav-links.active {
        transform: translateY(0);
    }
    .preview-nav-links li {
        margin: 15px 0;
    }
    .preview-footer-content {
        grid-template-columns: 1fr;
    }
    /* 修正：移动端社交链接布局 */
    .social-links-config {
        grid-template-columns: auto 1fr;
    }
}
</style>
</head>
<body class="admin-body">
<div class="admin-container">
<div class="admin-header">
<a href="index.html" class="nav-back">
<i class="fas fa-arrow-left"></i> 返回
</a>
<a href="https://zcfi.cn" class="admin-logo">zcfi<span>.</span>cn</a>
<div class="header-title">
<h1><i class="fas fa-cog"></i> 网站配置</h1>
<p>管理网站基本信息和页面内容</p>
</div>
</div>
<div class="admin-main-content">
<!-- 刷新按钮区域 -->
<div class="refresh-section">
<div class="admin-button-group">
<button class="admin-btn btn-secondary" id="refreshConfigBtn">
<i class="fas fa-sync-alt"></i> 刷新配置
</button>
<button class="admin-btn btn-info" id="backupConfigBtn">
<i class="fas fa-download"></i> 备份配置
</button>
</div>
</div>
<div class="config-layout">
<!-- 左侧导航 -->
<div class="config-sidebar">
<ul class="config-nav">
<li><a href="#site-info" class="active">
<i class="fas fa-info-circle"></i> 网站信息
</a></li>
<li><a href="#privacy-policy">
<i class="fas fa-shield-alt"></i> 隐私政策
</a></li>
<li><a href="#terms-of-service">
<i class="fas fa-file-contract"></i> 使用条款
</a></li>
<li><a href="#copyright">
<i class="fas fa-copyright"></i> 版权声明
</a></li>
<li><a href="#navigation">
<i class="fas fa-bars"></i> 导航栏配置
</a></li>
<li><a href="#footer">
<i class="fas fa-shoe-prints"></i> 页脚配置
</a></li>
</ul>
<div style="margin-top: 30px; padding: 15px; background: #e9ecef; border-radius: 8px;">
<h4 style="font-size: 14px; margin-bottom: 10px; color: #495057;">配置说明</h4>
<p style="font-size: 12px; color: #6c757d; line-height: 1.5;">
所有配置保存到独立的 Gist 中。<br>
保存后，前台页面会实时加载更新。
</p>
</div>
</div>
<!-- 右侧内容 -->
<div class="config-content">
<!-- 网站信息 -->
<div class="config-section active" id="site-info-section">
<div class="section-header">
<h2><i class="fas fa-info-circle"></i> 网站基本信息</h2>
<p>配置网站的名称、描述和联系信息</p>
</div>
<div class="compact-form">
<div class="form-group">
<label for="siteName"><i class="fas fa-globe"></i> 网站名称</label>
<input type="text" id="siteName" placeholder="例如：我的个人网站">
</div>
<div class="form-group">
<label for="siteDescription"><i class="fas fa-align-left"></i> 网站描述</label>
<textarea id="siteDescription" placeholder="网站的简短描述，用于 SEO 和社交媒体分享" rows="3"></textarea>
</div>
<div class="form-group">
<label for="siteKeywords"><i class="fas fa-tags"></i> 网站关键词</label>
<input type="text" id="siteKeywords" placeholder="例如：个人网站,技术博客,作品展示">
<div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
使用逗号分隔多个关键词
</div>
</div>
<div class="form-group">
<label for="adminEmail"><i class="fas fa-envelope"></i> 管理员邮箱</label>
<input type="email" id="adminEmail" placeholder="admin@example.com">
</div>
</div>
<div class="section-actions">
<button class="admin-btn btn-primary" onclick="saveCurrentSection('site-info')">
<i class="fas fa-save"></i> 保存网站信息
</button>
<button class="admin-btn btn-secondary" onclick="resetCurrentSection('site-info')">
<i class="fas fa-undo"></i> 重置
</button>
</div>
</div>
<!-- 隐私政策 -->
<div class="config-section" id="privacy-policy-section">
<div class="section-header">
<h2><i class="fas fa-shield-alt"></i> 隐私政策</h2>
<p>编辑网站隐私政策内容，支持 HTML 格式</p>
</div>
<div class="compact-form">
<div class="form-group">
<label for="privacyTitle"><i class="fas fa-heading"></i> 页面标题</label>
<input type="text" id="privacyTitle" placeholder="隐私政策">
</div>
<!-- 快捷HTML标签 -->
<div class="quick-tags">
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'h3')">h3标题</button>
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'p')">段落</button>
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'strong')">加粗</button>
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'em')">斜体</button>
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'ul')">列表</button>
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'li')">列表项</button>
<button type="button" class="tag-btn" onclick="insertTag('privacyContent', 'a')">链接</button>
</div>
<!-- 富文本编辑器工具栏 -->
<div class="editor-toolbar">
<button type="button" class="editor-btn" onclick="formatText('privacyContent', 'bold')">
<i class="fas fa-bold"></i> 加粗
</button>
<button type="button" class="editor-btn" onclick="formatText('privacyContent', 'italic')">
<i class="fas fa-italic"></i> 斜体
</button>
<button type="button" class="editor-btn" onclick="formatText('privacyContent', 'underline')">
<i class="fas fa-underline"></i> 下划线
</button>
<button type="button" class="editor-btn" onclick="formatText('privacyContent', 'link')">
<i class="fas fa-link"></i> 链接
</button>
<button type="button" class="editor-btn" onclick="formatText('privacyContent', 'list')">
<i class="fas fa-list"></i> 列表
</button>
<button type="button" class="editor-btn" onclick="formatText('privacyContent', 'quote')">
<i class="fas fa-quote-right"></i> 引用
</button>
</div>
<div class="form-group">
<label for="privacyContent"><i class="fas fa-file-alt"></i> 政策内容</label>
<textarea id="privacyContent" rows="10" placeholder="在此编辑隐私政策内容..."></textarea>
<div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
支持 HTML 标签，如 &lt;h3&gt;, &lt;p&gt;, &lt;strong&gt;, &lt;em&gt;, &lt;a&gt;, &lt;ul&gt;, &lt;li&gt; 等
</div>
</div>
<div class="form-group">
<label>页面状态</label>
<div class="toggle-switch">
<label class="toggle-container">
<input type="checkbox" id="privacyEnabled" class="toggle-checkbox" checked>
<span class="toggle-slider"></span>
</label>
<span class="toggle-label" id="privacyStatusLabel">已启用 (公开访问)</span>
</div>
</div>
</div>
<div class="preview-area">
<h4>预览效果：</h4>
<div class="preview-content" id="privacyPreview">
内容将在这里预览...
</div>
</div>
<div class="section-actions">
<button class="admin-btn btn-primary" onclick="saveCurrentSection('privacy')">
<i class="fas fa-save"></i> 保存隐私政策
</button>
<button class="admin-btn btn-secondary" onclick="previewContent('privacy')">
<i class="fas fa-eye"></i> 更新预览
</button>
<a href="../privacy.html" target="_blank" class="admin-btn btn-info">
<i class="fas fa-external-link-alt"></i> 查看页面
</a>
</div>
</div>
<!-- 使用条款 -->
<div class="config-section" id="terms-of-service-section">
<div class="section-header">
<h2><i class="fas fa-file-contract"></i> 使用条款</h2>
<p>编辑网站使用条款内容</p>
</div>
<div class="compact-form">
<div class="form-group">
<label for="termsTitle"><i class="fas fa-heading"></i> 页面标题</label>
<input type="text" id="termsTitle" placeholder="使用条款">
</div>
<!-- 快捷HTML标签 -->
<div class="quick-tags">
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'h3')">h3标题</button>
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'p')">段落</button>
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'strong')">加粗</button>
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'em')">斜体</button>
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'ul')">列表</button>
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'li')">列表项</button>
<button type="button" class="tag-btn" onclick="insertTag('termsContent', 'a')">链接</button>
</div>
<div class="form-group">
<label for="termsContent"><i class="fas fa-file-alt"></i> 条款内容</label>
<textarea id="termsContent" rows="10" placeholder="在此编辑使用条款内容..."></textarea>
</div>
<div class="form-group">
<label>页面状态</label>
<div class="toggle-switch">
<label class="toggle-container">
<input type="checkbox" id="termsEnabled" class="toggle-checkbox" checked>
<span class="toggle-slider"></span>
</label>
<span class="toggle-label" id="termsStatusLabel">已启用 (公开访问)</span>
</div>
</div>
</div>
<div class="preview-area">
<h4>预览效果：</h4>
<div class="preview-content" id="termsPreview">
内容将在这里预览...
</div>
</div>
<div class="section-actions">
<button class="admin-btn btn-primary" onclick="saveCurrentSection('terms')">
<i class="fas fa-save"></i> 保存使用条款
</button>
<button class="admin-btn btn-secondary" onclick="previewContent('terms')">
<i class="fas fa-eye"></i> 更新预览
</button>
<a href="../terms.html" target="_blank" class="admin-btn btn-info">
<i class="fas fa-external-link-alt"></i> 查看页面
</a>
</div>
</div>
<!-- 版权声明 -->
<div class="config-section" id="copyright-section">
<div class="section-header">
<h2><i class="fas fa-copyright"></i> 版权声明</h2>
<p>编辑网站版权声明内容</p>
</div>
<div class="compact-form">
<div class="form-group">
<label for="copyrightTitle"><i class="fas fa-heading"></i> 页面标题</label>
<input type="text" id="copyrightTitle" placeholder="版权声明">
</div>
<!-- 快捷HTML标签 -->
<div class="quick-tags">
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'h3')">h3标题</button>
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'p')">段落</button>
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'strong')">加粗</button>
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'em')">斜体</button>
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'ul')">列表</button>
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'li')">列表项</button>
<button type="button" class="tag-btn" onclick="insertTag('copyrightContent', 'a')">链接</button>
</div>
<div class="form-group">
<label for="copyrightContent"><i class="fas fa-file-alt"></i> 声明内容</label>
<textarea id="copyrightContent" rows="10" placeholder="在此编辑版权声明内容..."></textarea>
</div>
<div class="form-group">
<label>页面状态</label>
<div class="toggle-switch">
<label class="toggle-container">
<input type="checkbox" id="copyrightEnabled" class="toggle-checkbox" checked>
<span class="toggle-slider"></span>
</label>
<span class="toggle-label" id="copyrightStatusLabel">已启用 (公开访问)</span>
</div>
</div>
</div>
<div class="preview-area">
<h4>预览效果：</h4>
<div class="preview-content" id="copyrightPreview">
内容将在这里预览...
</div>
</div>
<div class="section-actions">
<button class="admin-btn btn-primary" onclick="saveCurrentSection('copyright')">
<i class="fas fa-save"></i> 保存版权声明
</button>
<button class="admin-btn btn-secondary" onclick="previewContent('copyright')">
<i class="fas fa-eye"></i> 更新预览
</button>
<a href="../copyright.html" target="_blank" class="admin-btn btn-info">
<i class="fas fa-external-link-alt"></i> 查看页面
</a>
</div>
</div>
<!-- 导航栏配置 -->
<div class="config-section" id="navigation-section">
<div class="section-header">
<h2><i class="fas fa-bars"></i> 导航栏配置</h2>
<p>管理网站导航菜单项</p>
</div>
<div class="compact-form">
<div class="form-group">
<label for="navItems"><i class="fas fa-list"></i> 导航菜单项</label>
<div id="navItemsContainer">
<!-- 动态生成的导航项表单，首页项会自动创建 -->
</div>
<button type="button" class="admin-btn btn-secondary" onclick="addNavItem()" style="margin-top: 10px;">
<i class="fas fa-plus"></i> 添加菜单项
</button>
<p style="font-size: 12px; color: #6c757d; margin-top: 8px;">
注意：首页项固定为第一项，不可删除或移动
</p>
</div>
<div class="preview-area">
<h4>导航栏预览：</h4>
<div class="preview-content">
<!-- 真实导航栏样式预览 -->
<div class="preview-nav">
<div class="preview-navbar">
<a href="https://zcfi.cn" class="preview-logo">zcfi<span>.</span>cn</a>
<ul class="preview-nav-links" id="navPreviewLinks">
<li><a href="https://zcfi.cn">首页</a></li>
<li><a href="https://zcfi.cn/portfolio.html">作品集</a></li>
<li><a href="https://zcfi.cn/blog.html">博客</a></li>
<li><a href="https://zcfi.cn/contact.html">联系我</a></li>
</ul>
<div class="preview-mobile-menu-btn">
<i class="fas fa-bars"></i>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section-actions">
<button class="admin-btn btn-primary" onclick="saveCurrentSection('navigation')">
<i class="fas fa-save"></i> 保存导航栏配置
</button>
<button class="admin-btn btn-secondary" onclick="previewNavigation()">
<i class="fas fa-eye"></i> 更新预览
</button>
</div>
</div>
<!-- 页脚配置 - 完整重构 -->
<div class="config-section" id="footer-section">
<div class="section-header">
<h2><i class="fas fa-shoe-prints"></i> 页脚配置</h2>
<p>完整配置网站页脚的所有内容</p>
</div>
<div class="footer-config-form">
<!-- 页脚描述 -->
<div class="form-group">
<label for="footerDescription"><i class="fas fa-align-left"></i> 页脚描述</label>
<textarea id="footerDescription" placeholder="在页脚显示的网站描述，例如：个人网站和作品展示平台"></textarea>
</div>
<!-- 社交链接 -->
<div class="form-group">
<label><i class="fas fa-share-alt"></i> 社交媒体链接</label>
<div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-top: 10px;">
<div class="social-links-config">
<div class="social-icon-preview">
<i class="fab fa-github"></i>
</div>
<div class="social-link-input">
<input type="url" id="githubUrl" placeholder="https://github.com/yourusername (完整 URL，以 http:// 或 https:// 开头)" class="form-control" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span>GitHub 链接</span>
</div>
</div>
</div>
<div class="social-links-config">
<div class="social-icon-preview">
<i class="fab fa-weibo"></i>
</div>
<div class="social-link-input">
<input type="url" id="weiboUrl" placeholder="https://weibo.com/yourprofile (完整 URL，以 http:// 或 https:// 开头)" class="form-control" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span>微博链接 (可选)</span>
</div>
</div>
</div>
<div class="social-links-config">
<div class="social-icon-preview">
<i class="fab fa-zhihu"></i>
</div>
<div class="social-link-input">
<input type="url" id="zhihuUrl" placeholder="https://www.zhihu.com/people/yourprofile (完整 URL，以 http:// 或 https:// 开头)" class="form-control" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span>知乎链接 (可选)</span>
</div>
</div>
</div>
<div class="social-links-config">
<div class="social-icon-preview">
<i class="fab fa-linkedin"></i>
</div>
<div class="social-link-input">
<input type="url" id="linkedinUrl" placeholder="https://linkedin.com/in/yourprofile (完整 URL，以 http:// 或 https:// 开头)" class="form-control" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span>LinkedIn 链接 (可选)</span>
</div>
</div>
</div>
<div style="font-size: 13px; color: #6c757d; margin-top: 8px;">
注：留空的链接不会在页脚显示
</div>
</div>
</div>
<!-- 快速链接 -->
<div class="form-group">
<label><i class="fas fa-bolt"></i> 快速链接</label>
<div class="footer-links-container" id="quickLinksContainer">
<div class="footer-link-item">
<input type="text" class="quick-link-name" placeholder="链接名称 (例如：首页)">
<input type="url" class="quick-link-url" placeholder="https://zcfi.cn (完整 URL，以 http:// 或 https:// 开头)" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span></span>
</div>
<button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
<i class="fas fa-trash"></i>
</button>
</div>
<div class="footer-link-item">
<input type="text" class="quick-link-name" placeholder="链接名称 (例如：作品集)">
<input type="url" class="quick-link-url" placeholder="https://zcfi.cn/portfolio.html (完整 URL，以 http:// 或 https:// 开头)" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span></span>
</div>
<button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
<i class="fas fa-trash"></i>
</button>
</div>
<div class="footer-link-item">
<input type="text" class="quick-link-name" placeholder="链接名称 (例如：博客)">
<input type="url" class="quick-link-url" placeholder="https://zcfi.cn/blog.html (完整 URL，以 http:// 或 https:// 开头)" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span></span>
</div>
<button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
<i class="fas fa-trash"></i>
</button>
</div>
<div class="footer-link-item">
<input type="text" class="quick-link-name" placeholder="链接名称 (例如：联系我)">
<input type="url" class="quick-link-url" placeholder="https://zcfi.cn/contact.html (完整 URL，以 http:// 或 https:// 开头)" oninput="validateUrl(this)">
<div class="url-validation">
<i class="fas fa-check-circle url-valid" style="display:none;"></i>
<i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
<span></span>
</div>
<button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
<i class="fas fa-trash"></i>
</button>
</div>
</div>
<button type="button" class="admin-btn btn-secondary" onclick="addQuickLink()" style="margin-top: 10px;">
<i class="fas fa-plus"></i> 添加快速链接
</button>
</div>
<!-- 法律声明链接 (完全可配置) -->
<div class="form-group">
<label><i class="fas fa-scale-balanced"></i> 法律声明链接</label>
<div class="footer-links-container" id="legalLinksContainer">
<!-- 动态生成的法律声明链接项 -->
</div>
<button type="button" class="admin-btn btn-secondary" onclick="addLegalLink()" style="margin-top: 10px;">
<i class="fas fa-plus"></i> 添加法律声明链接
</button>
<p style="font-size: 12px; color: #6c757d; margin-top: 8px;">
注：法律声明链接可在"隐私政策"、"使用条款"等页面配置启用/禁用
</p>
</div>
<!-- 版权信息 -->
<div class="form-group">
<label for="footerCopyright"><i class="fas fa-copyright"></i> 版权信息</label>
<input type="text" id="footerCopyright" placeholder="例如：© 2026 zcfi.cn 版权所有" value="© 2026 zcfi.cn 版权所有">
<div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
支持HTML格式，如：&lt;span&gt;© 2026 zcfi.cn &lt;/span&gt;&lt;strong&gt;版权所有&lt;/strong&gt;
</div>
</div>
</div>
<div class="preview-area">
<h4>页脚预览 (真实效果)：
<button class="admin-btn btn-secondary fullscreen-btn" onclick="openFullscreenPreview('footer')" style="padding: 4px 10px; font-size: 13px;">
<i class="fas fa-expand"></i> 全屏预览
</button>
</h4>
<div class="preview-content">
<!-- 真实页脚样式预览 -->
<footer class="preview-footer">
<div class="preview-footer-content">
<div class="preview-footer-about">
<a href="https://zcfi.cn" class="preview-footer-logo">zcfi<span>.</span>cn</a>
<p id="previewFooterDescription">个人网站和作品展示平台</p>
<div class="preview-social-links" id="previewSocialLinks">
<a href="https://github.com" target="_blank"><i class="fab fa-github"></i></a>
<a href="https://weibo.com" target="_blank"><i class="fab fa-weibo"></i></a>
<a href="https://zhihu.com" target="_blank"><i class="fab fa-zhihu"></i></a>
<a href="https://linkedin.com" target="_blank"><i class="fab fa-linkedin"></i></a>
</div>
</div>
<div class="preview-footer-links">
<h3 class="preview-footer-heading">快速链接</h3>
<ul id="previewQuickLinks">
<li><a href="https://zcfi.cn">首页</a></li>
<li><a href="https://zcfi.cn/portfolio.html">作品集</a></li>
<li><a href="https://zcfi.cn/blog.html">博客</a></li>
<li><a href="https://zcfi.cn/contact.html">联系我</a></li>
</ul>
</div>
<div class="preview-footer-links">
<h3 class="preview-footer-heading">法律声明</h3>
<ul id="previewLegalLinks">
<li><a href="https://zcfi.cn/privacy.html">隐私政策</a></li>
<li><a href="https://zcfi.cn/terms.html">使用条款</a></li>
<li><a href="https://zcfi.cn/copyright.html">版权声明</a></li>
</ul>
</div>
</div>
<div class="preview-compliance">
<p id="previewCopyright">© 2026 zcfi.cn 版权所有</p>
<div class="preview-compliance-links" id="previewComplianceLinks">
<a href="https://zcfi.cn/privacy.html">隐私政策</a>
<a href="https://zcfi.cn/terms.html">使用条款</a>
<a href="https://zcfi.cn/copyright.html">版权声明</a>
</div>
</div>
</footer>
</div>
</div>
<div class="section-actions">
<button class="admin-btn btn-primary" onclick="saveCurrentSection('footer')">
<i class="fas fa-save"></i> 保存页脚配置
</button>
<button class="admin-btn btn-secondary" onclick="previewFooter()">
<i class="fas fa-eye"></i> 更新预览
</button>
</div>
</div>
</div>
</div>
<div class="admin-footer">
<p>© 2026 zcfi.cn 配置管理系统</p>
<p style="margin-top: 10px; font-size: 13px; color: #6c757d;">
注意：保存的配置将同步到GitHub Gist，网站前端会实时加载最新配置。
</p>
</div>
</div>
</div>
<!-- 全屏预览模态框 -->
<div class="fullscreen-preview-modal" id="fullscreenPreviewModal">
<div class="fullscreen-preview-container">
<div class="fullscreen-preview-header">
<div class="fullscreen-preview-title" id="fullscreenPreviewTitle">预览</div>
<button class="close-fullscreen-btn" onclick="closeFullscreenPreview()">
<i class="fas fa-times"></i>
</button>
</div>
<div class="fullscreen-preview-content" id="fullscreenPreviewContent">
<!-- 预览内容将在这里动态生成 -->
</div>
</div>
</div>
<!-- 使用公共弹窗 -->
<div class="custom-modal" id="confirmModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-question-circle"></i>
</div>
<div class="modal-title">确认保存</div>
<div class="modal-message" id="confirmMessage">确定要保存当前配置吗？这将覆盖现有的配置数据。</div>
<div class="modal-buttons">
<button class="modal-btn btn-secondary" id="cancelSaveBtn">取消</button>
<button class="modal-btn btn-primary" id="confirmSaveBtn">确认保存</button>
</div>
</div>
</div>
<!-- 结果弹窗 -->
<div class="custom-modal" id="resultModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-info-circle" id="resultIcon"></i>
</div>
<div class="modal-title" id="resultTitle">操作结果</div>
<div class="modal-message" id="resultMessage">操作已完成</div>
<div class="modal-buttons">
<button class="modal-btn btn-primary" id="closeResultBtn">确定</button>
</div>
</div>
</div>
<!-- 加载弹窗 -->
<div class="custom-modal" id="loadingModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-spinner loading-spinner"></i>
</div>
<div class="modal-title">处理中</div>
<div class="modal-message" id="loadingMessage">正在处理您的请求，请稍候...</div>
</div>
</div>
<script>
// 安全验证
if (!sessionStorage.getItem('admin_verified') || !sessionStorage.getItem('admin_token')) {
    alert('❌ 未授权访问！请通过后台首页登录。');
    window.location.href = 'index.html';
}

// 全局配置
const CONFIG_GIST_ID = '983bb7371ddb439a2fcbfb4885e34d14';
const CONFIG_GIST_URL = `https://api.github.com/gists/${CONFIG_GIST_ID}`;
const CONFIG_RAW_URL = `https://gist.githubusercontent.com/xiao305/${CONFIG_GIST_ID}/raw/config.json`;
const token = sessionStorage.getItem('admin_token');
let currentConfigData = {};
let currentSection = 'site-info';
let isSaving = false; // 防止重复提交
let retryCount = 0; // 重试次数
const MAX_RETRIES = 3; // 最大重试次数
const HOME_PAGE_URL = 'https://zcfi.cn'; // 固定首页URL

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    initNavigation();
    initEventListeners();
    initToggleSwitches();
    initFooterConfig();
    loadConfigData();
    // 初始化法律声明链接为默认值
    setTimeout(() => {
        populateLegalLinks([
            { name: '隐私政策', url: 'https://zcfi.cn/privacy.html' },
            { name: '使用条款', url: 'https://zcfi.cn/terms.html' },
            { name: '版权声明', url: 'https://zcfi.cn/copyright.html' }
        ]);
    }, 100);
});

// 初始化导航
function initNavigation() {
    document.querySelectorAll('.config-nav a').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            // 更新导航状态
            document.querySelectorAll('.config-nav a').forEach(a => a.classList.remove('active'));
            this.classList.add('active');
            // 获取目标部分
            const targetId = this.getAttribute('href').substring(1);
            // 隐藏所有部分
            document.querySelectorAll('.config-section').forEach(section => {
                section.classList.remove('active');
            });
            // 显示目标部分
            const targetSection = document.getElementById(`${targetId}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = targetId;
            }
        });
    });
}

// 初始化事件监听器
function initEventListeners() {
    // 主按钮
    document.getElementById('refreshConfigBtn').addEventListener('click', loadConfigData);
    document.getElementById('backupConfigBtn').addEventListener('click', backupConfig);
    
    // 弹窗按钮
    document.getElementById('cancelSaveBtn').addEventListener('click', closeConfirmModal);
    document.getElementById('confirmSaveBtn').addEventListener('click', executeSave);
    document.getElementById('closeResultBtn').addEventListener('click', closeResultModal);
    
    // 实时预览
    document.getElementById('privacyContent').addEventListener('input', function() {
        previewContent('privacy');
    });
    document.getElementById('termsContent').addEventListener('input', function() {
        previewContent('terms');
    });
    document.getElementById('copyrightContent').addEventListener('input', function() {
        previewContent('copyright');
    });
    document.getElementById('footerDescription').addEventListener('input', function() {
        document.getElementById('previewFooterDescription').textContent = this.value || '个人网站和作品展示平台';
    });
    document.getElementById('footerCopyright').addEventListener('input', function() {
        document.getElementById('previewCopyright').innerHTML = this.value || '© 2026 zcfi.cn 版权所有';
    });
    
    // 社交链接预览
    document.getElementById('githubUrl').addEventListener('input', function() {
        validateUrl(this);
        previewFooter();
    });
    document.getElementById('weiboUrl').addEventListener('input', function() {
        validateUrl(this);
        previewFooter();
    });
    document.getElementById('zhihuUrl').addEventListener('input', function() {
        validateUrl(this);
        previewFooter();
    });
    document.getElementById('linkedinUrl').addEventListener('input', function() {
        validateUrl(this);
        previewFooter();
    });
}

// 初始化开关
function initToggleSwitches() {
    // 隐私政策开关
    document.getElementById('privacyEnabled').addEventListener('change', function() {
        document.getElementById('privacyStatusLabel').textContent =
            this.checked ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
    });
    // 使用条款开关
    document.getElementById('termsEnabled').addEventListener('change', function() {
        document.getElementById('termsStatusLabel').textContent =
            this.checked ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
    });
    // 版权声明开关
    document.getElementById('copyrightEnabled').addEventListener('change', function() {
        document.getElementById('copyrightStatusLabel').textContent =
            this.checked ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
    });
}

// 初始化页脚配置
function initFooterConfig() {
    // 快速链接动态操作
    document.querySelectorAll('.remove-link-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            this.closest('.footer-link-item').remove();
            previewFooter();
        });
    });
    
    // 为现有的输入框添加事件监听
    document.querySelectorAll('.quick-link-name, .quick-link-url, .legal-link-name, .legal-link-url').forEach(input => {
        input.addEventListener('input', previewFooter);
    });
}

// 验证URL格式
function validateUrl(inputElement) {
    const url = inputElement.value.trim();
    const validationElement = inputElement.closest('.footer-link-item, .social-links-config').querySelector('.url-validation');
    const validIcon = validationElement.querySelector('.url-valid');
    const invalidIcon = validationElement.querySelector('.url-invalid');
    
    if (!url) {
        validIcon.style.display = 'none';
        invalidIcon.style.display = 'none';
        return true;
    }
    
    // 检查是否是完整URL
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        validIcon.style.display = 'none';
        invalidIcon.style.display = 'inline-block';
        invalidIcon.title = 'URL必须以http://或https://开头';
        return false;
    }
    
    try {
        new URL(url);
        validIcon.style.display = 'inline-block';
        invalidIcon.style.display = 'none';
        return true;
    } catch (e) {
        validIcon.style.display = 'none';
        invalidIcon.style.display = 'inline-block';
        invalidIcon.title = e.message;
        return false;
    }
}

// 加载配置数据
async function loadConfigData() {
    try {
        showLoading('正在从服务器获取最新配置...');
        const timestamp = new Date().getTime();
        const response = await fetch(`${CONFIG_RAW_URL}?t=${timestamp}`);
        if (!response.ok) {
            // 如果Gist不存在或为空，使用默认配置
            console.warn('配置Gist不存在或为空，使用默认配置');
            currentConfigData = getDefaultConfig();
            populateFormWithConfig(currentConfigData);
            hideLoading();
            showResult('info', '提示', '使用默认配置，请保存以创建配置文件。');
            return;
        }
        const data = await response.json();
        currentConfigData = data;
        populateFormWithConfig(data);
        hideLoading();
        showResult('success', '刷新成功', '配置数据已成功加载。');
    } catch (error) {
        console.error('加载配置失败:', error);
        currentConfigData = getDefaultConfig();
        populateFormWithConfig(currentConfigData);
        hideLoading();
        showResult('error', '加载失败', '无法加载配置，使用默认设置。');
    }
}

// 获取默认配置
function getDefaultConfig() {
    return {
        site: {
            name: 'zcfi.cn',
            description: '个人网站和作品展示平台',
            keywords: '个人网站,技术博客,作品展示',
            adminEmail: 'admin@zcfi.cn',
            lastUpdated: new Date().toISOString()
        },
        privacy: {
            title: '隐私政策',
            content: `<h3>1. 信息收集</h3>
<p>本站为个人非商业网站，不主动收集用户任何个人信息。</p>
<h3>2. 数据安全</h3>
<p>所有通过表单提交的数据将通过 HTTPS 加密传输。</p>
<h3>3. 联系我们</h3>
<p>如有任何隐私相关疑问，请通过联系页面与我沟通。</p>`,
            enabled: true,
            lastUpdated: new Date().toISOString()
        },
        terms: {
            title: '使用条款',
            content: `<h3>1. 接受条款</h3>
<p>通过访问和使用本网站，您同意遵守以下使用条款。</p>
<h3>2. 网站内容</h3>
<p>本网站所有内容均为原创或已获得合法授权，受版权法保护。</p>
<h3>3. 免责声明</h3>
<p>本网站按"现状"提供，不提供任何形式的保证。</p>`,
            enabled: true,
            lastUpdated: new Date().toISOString()
        },
        copyright: {
            title: '版权声明',
            content: `<h3>1. 版权归属</h3>
<p>本网站的所有原创内容均归网站所有者所有。</p>
<h3>2. 使用许可</h3>
<p>允许个人用户出于学习、研究目的下载、保存和参考本网站内容。</p>
<h3>3. 禁止行为</h3>
<p>未经授权，严禁复制、转载或重新发布本网站内容。</p>`,
            enabled: true,
            lastUpdated: new Date().toISOString()
        },
        social: {
            github: '',
            weibo: '',
            zhihu: '',
            linkedin: '',
            lastUpdated: new Date().toISOString()
        },
        navigation: {
            items: [
                { name: '首页', url: HOME_PAGE_URL, order: 1, fixed: true }
            ],
            lastUpdated: new Date().toISOString()
        },
        footer: {
            description: '个人网站和作品展示平台',
            quickLinks: [
                { name: '首页', url: HOME_PAGE_URL },
                { name: '作品集', url: 'https://zcfi.cn/portfolio.html' },
                { name: '博客', url: 'https://zcfi.cn/blog.html' },
                { name: '联系我', url: 'https://zcfi.cn/contact.html' }
            ],
            legalLinks: [
                { name: '隐私政策', url: 'https://zcfi.cn/privacy.html' },
                { name: '使用条款', url: 'https://zcfi.cn/terms.html' },
                { name: '版权声明', url: 'https://zcfi.cn/copyright.html' }
            ],
            social: {
                github: 'https://github.com',
                weibo: '',
                zhihu: '',
                linkedin: ''
            },
            copyright: '© 2026 zcfi.cn 版权所有',
            lastUpdated: new Date().toISOString()
        }
    };
}

// 填充表单数据
function populateFormWithConfig(config) {
    // 网站信息
    if (config.site) {
        document.getElementById('siteName').value = config.site.name || '';
        document.getElementById('siteDescription').value = config.site.description || '';
        document.getElementById('siteKeywords').value = config.site.keywords || '';
        document.getElementById('adminEmail').value = config.site.adminEmail || '';
    }
    
    // 隐私政策
    if (config.privacy) {
        document.getElementById('privacyTitle').value = config.privacy.title || '';
        document.getElementById('privacyContent').value = config.privacy.content || '';
        document.getElementById('privacyEnabled').checked = config.privacy.enabled !== false;
        document.getElementById('privacyStatusLabel').textContent =
            config.privacy.enabled !== false ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
        previewContent('privacy');
    }
    
    // 使用条款
    if (config.terms) {
        document.getElementById('termsTitle').value = config.terms.title || '';
        document.getElementById('termsContent').value = config.terms.content || '';
        document.getElementById('termsEnabled').checked = config.terms.enabled !== false;
        document.getElementById('termsStatusLabel').textContent =
            config.terms.enabled !== false ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
        previewContent('terms');
    }
    
    // 版权声明
    if (config.copyright) {
        document.getElementById('copyrightTitle').value = config.copyright.title || '';
        document.getElementById('copyrightContent').value = config.copyright.content || '';
        document.getElementById('copyrightEnabled').checked = config.copyright.enabled !== false;
        document.getElementById('copyrightStatusLabel').textContent =
            config.copyright.enabled !== false ? '已启用 (公开访问)' : '已禁用 (隐藏页面)';
        previewContent('copyright');
    }
    
    // 导航栏配置
    if (config.navigation) {
        populateNavigationForm(config.navigation.items || []);
        previewNavigation();
    }
    
    // 页脚配置（完整整合）
    if (config.footer) {
        // 页脚描述
        document.getElementById('footerDescription').value = config.footer.description || '';
        
        // 社交链接
        const social = config.footer.social || config.social || {};
        document.getElementById('githubUrl').value = social.github || '';
        document.getElementById('weiboUrl').value = social.weibo || '';
        document.getElementById('zhihuUrl').value = social.zhihu || '';
        document.getElementById('linkedinUrl').value = social.linkedin || '';
        
        // 快速链接
        populateQuickLinks(config.footer.quickLinks || []);
        
        // 法律声明链接
        populateLegalLinks(config.footer.legalLinks || []);
        
        // 版权信息
        document.getElementById('footerCopyright').value = config.footer.copyright || '© 2026 zcfi.cn 版权所有';
        
        // 预览
        previewFooter();
    }
}

// 填充导航项表单
function populateNavigationForm(items) {
    const container = document.getElementById('navItemsContainer');
    container.innerHTML = '';
    // 按order排序
    const sortedItems = [...items].sort((a, b) => (a.order || 0) - (b.order || 0));
    sortedItems.forEach((item, index) => {
        const isFixed = item.fixed || (item.name === '首页' && item.url === HOME_PAGE_URL);
        const itemHtml = `
        <div class="nav-item-row ${isFixed ? 'homepage-item' : ''}">
            <input type="hidden" name="navOrder" value="${item.order || index + 1}">
            <input type="text" class="nav-item-name" placeholder="菜单名称" value="${escapeHtml(item.name || '')}" ${isFixed ? 'readonly' : ''}>
            <input type="url" class="nav-item-url" placeholder="https://example.com/subpage (完整URL)" value="${escapeHtml(item.url || '')}" oninput="validateUrl(this)" ${isFixed ? 'readonly' : ''}>
            <button type="button" class="admin-btn btn-danger btn-sm" onclick="removeNavItem(this)" ${isFixed ? 'disabled' : ''}>
                <i class="fas fa-trash"></i>
            </button>
            <button type="button" class="admin-btn btn-secondary btn-sm" onclick="moveNavItemUp(this)" ${index === 0 ? 'disabled' : ''}>
                <i class="fas fa-arrow-up"></i>
            </button>
            <button type="button" class="admin-btn btn-secondary btn-sm" onclick="moveNavItemDown(this)" ${isFixed ? 'disabled' : ''}>
                <i class="fas fa-arrow-down"></i>
            </button>
        </div>
        `;
        container.innerHTML += itemHtml;
    });
    
    // 为URL输入框添加验证
    container.querySelectorAll('input.nav-item-url').forEach(input => {
        input.addEventListener('blur', function() {
            validateUrl(this);
        });
    });
}

// 添加导航项
function addNavItem() {
    const container = document.getElementById('navItemsContainer');
    const items = container.querySelectorAll('.nav-item-row');
    const nextOrder = items.length + 1;
    const itemHtml = `
    <div class="nav-item-row">
        <input type="hidden" name="navOrder" value="${nextOrder}">
        <input type="text" class="nav-item-name" placeholder="菜单名称" value="">
        <input type="url" class="nav-item-url" placeholder="https://example.com/subpage (完整URL)" value="" oninput="validateUrl(this)">
        <button type="button" class="admin-btn btn-danger btn-sm" onclick="removeNavItem(this)">
            <i class="fas fa-trash"></i>
        </button>
        <button type="button" class="admin-btn btn-secondary btn-sm" onclick="moveNavItemUp(this)">
            <i class="fas fa-arrow-up"></i>
        </button>
        <button type="button" class="admin-btn btn-secondary btn-sm" onclick="moveNavItemDown(this)">
            <i class="fas fa-arrow-down"></i>
        </button>
    </div>
    `;
    container.innerHTML += itemHtml;
    previewNavigation();
}

// 移除导航项
function removeNavItem(button) {
    const row = button.closest('.nav-item-row');
    // 检查是否是首页项
    const nameInput = row.querySelector('.nav-item-name');
    if (nameInput && nameInput.value === '首页' && nameInput.readOnly) {
        showResult('info', '操作受限', '首页项不可删除');
        return;
    }
    row.remove();
    updateNavItemOrders();
    previewNavigation();
}

// 上移导航项
function moveNavItemUp(button) {
    const row = button.closest('.nav-item-row');
    const prevRow = row.previousElementSibling;
    if (prevRow && prevRow.classList.contains('nav-item-row')) {
        // 检查上一项是否是首页项
        const prevNameInput = prevRow.querySelector('.nav-item-name');
        if (prevNameInput && prevNameInput.value === '首页' && prevNameInput.readOnly) {
            showResult('info', '操作受限', '首页项必须在最前面');
            return;
        }
        row.parentNode.insertBefore(row, prevRow);
        updateNavItemOrders();
        previewNavigation();
    }
}

// 下移导航项
function moveNavItemDown(button) {
    const row = button.closest('.nav-item-row');
    const nextRow = row.nextElementSibling;
    if (nextRow && nextRow.classList.contains('nav-item-row')) {
        row.parentNode.insertBefore(nextRow, row);
        updateNavItemOrders();
        previewNavigation();
    }
}

// 更新导航项顺序
function updateNavItemOrders() {
    const items = document.querySelectorAll('.nav-item-row');
    items.forEach((item, index) => {
        const orderInput = item.querySelector('input[name="navOrder"]');
        if (orderInput) {
            orderInput.value = index + 1;
        }
    });
}

// 预览导航栏
function previewNavigation() {
    const previewElement = document.getElementById('navPreviewLinks');
    const items = [];
    document.querySelectorAll('.nav-item-row').forEach(row => {
        const nameInput = row.querySelector('.nav-item-name');
        const urlInput = row.querySelector('.nav-item-url');
        const orderInput = row.querySelector('input[name="navOrder"]');
        if (nameInput && urlInput && nameInput.value && urlInput.value) {
            items.push({
                name: nameInput.value,
                url: urlInput.value,
                order: parseInt(orderInput?.value || '0')
            });
        }
    });
    // 按order排序
    const sortedItems = [...items].sort((a, b) => a.order - b.order);
    
    // 确保首页项始终是第一项
    if (!sortedItems.some(item => item.name === '首页')) {
        sortedItems.unshift({
            name: '首页',
            url: HOME_PAGE_URL,
            order: 1
        });
    }
    
    previewElement.innerHTML = sortedItems.map(item => 
        `<li><a href="${escapeHtml(item.url)}">${escapeHtml(item.name)}</a></li>`
    ).join('');
}

// 填充快速链接
function populateQuickLinks(links) {
    const container = document.getElementById('quickLinksContainer');
    container.innerHTML = '';
    links.forEach(link => {
        container.innerHTML += `
        <div class="footer-link-item">
            <input type="text" class="quick-link-name" placeholder="链接名称" value="${escapeHtml(link.name || '')}">
            <input type="url" class="quick-link-url" placeholder="https://example.com/subpage (完整URL)" value="${escapeHtml(link.url || '')}" oninput="validateUrl(this)">
            <div class="url-validation">
                <i class="fas fa-check-circle url-valid" style="display:none;"></i>
                <i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
                <span></span>
            </div>
            <button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        `;
    });
    // 为新添加的删除按钮添加事件监听
    document.querySelectorAll('.remove-link-btn').forEach(btn => {
        btn.removeEventListener('click', removeLinkItem);
        btn.addEventListener('click', removeLinkItem);
    });
}

// 填充法律声明链接
function populateLegalLinks(links) {
    const container = document.getElementById('legalLinksContainer');
    container.innerHTML = '';
    
    // 确保至少有默认的三个法律声明链接
    if (!links || links.length === 0) {
        links = [
            { name: '隐私政策', url: 'https://zcfi.cn/privacy.html' },
            { name: '使用条款', url: 'https://zcfi.cn/terms.html' },
            { name: '版权声明', url: 'https://zcfi.cn/copyright.html' }
        ];
    }
    
    links.forEach(link => {
        container.innerHTML += `
        <div class="footer-link-item">
            <input type="text" class="legal-link-name" placeholder="链接名称" value="${escapeHtml(link.name || '')}">
            <input type="url" class="legal-link-url" placeholder="https://example.com/page.html (完整URL)" value="${escapeHtml(link.url || '')}" oninput="validateUrl(this)">
            <div class="url-validation">
                <i class="fas fa-check-circle url-valid" style="display:none;"></i>
                <i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
                <span></span>
            </div>
            <button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        `;
    });
    
    // 为新添加的删除按钮添加事件监听
    document.querySelectorAll('.remove-link-btn').forEach(btn => {
        btn.removeEventListener('click', removeLinkItem);
        btn.addEventListener('click', removeLinkItem);
    });
}

// 移除链接项
function removeLinkItem() {
    const item = this.closest('.footer-link-item');
    // 检查是否是必须的法律声明链接
    const linkNameInput = item.querySelector('.legal-link-name, .quick-link-name');
    if (linkNameInput && 
        ['首页', '隐私政策', '使用条款', '版权声明'].includes(linkNameInput.value) &&
        document.querySelectorAll('.footer-link-item').length <= (linkNameInput.classList.contains('legal-link-name') ? 3 : 1)) {
        showResult('info', '操作受限', '至少需要保留此链接');
        return;
    }
    item.remove();
    previewFooter();
}

// 添加快速链接
function addQuickLink() {
    const container = document.getElementById('quickLinksContainer');
    const itemHtml = `
    <div class="footer-link-item">
        <input type="text" class="quick-link-name" placeholder="链接名称" value="">
        <input type="url" class="quick-link-url" placeholder="https://example.com/subpage (完整URL)" value="" oninput="validateUrl(this)">
        <div class="url-validation">
            <i class="fas fa-check-circle url-valid" style="display:none;"></i>
            <i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
            <span></span>
        </div>
        <button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
            <i class="fas fa-trash"></i>
        </button>
    </div>
    `;
    container.innerHTML += itemHtml;
    // 为新添加的删除按钮添加事件监听
    container.lastElementChild.querySelector('.remove-link-btn').addEventListener('click', removeLinkItem);
    // 为新添加的URL输入框添加验证
    container.lastElementChild.querySelector('.quick-link-url').addEventListener('blur', function() {
        validateUrl(this);
    });
}

// 添加法律声明链接
function addLegalLink() {
    const container = document.getElementById('legalLinksContainer');
    const itemHtml = `
    <div class="footer-link-item">
        <input type="text" class="legal-link-name" placeholder="链接名称" value="">
        <input type="url" class="legal-link-url" placeholder="https://example.com/page.html (完整URL)" value="" oninput="validateUrl(this)">
        <div class="url-validation">
            <i class="fas fa-check-circle url-valid" style="display:none;"></i>
            <i class="fas fa-exclamation-circle url-invalid" style="display:none;"></i>
            <span></span>
        </div>
        <button type="button" class="admin-btn btn-danger btn-sm remove-link-btn">
            <i class="fas fa-trash"></i>
        </button>
    </div>
    `;
    container.innerHTML += itemHtml;
    // 为新添加的删除按钮添加事件监听
    container.lastElementChild.querySelector('.remove-link-btn').addEventListener('click', removeLinkItem);
    // 为新添加的URL输入框添加验证
    container.lastElementChild.querySelector('.legal-link-url').addEventListener('blur', function() {
        validateUrl(this);
    });
}

// 预览页脚 - 完全按照前端样式
function previewFooter() {
    // 1. 页脚描述
    const footerDesc = document.getElementById('footerDescription').value.trim() || '个人网站和作品展示平台';
    document.getElementById('previewFooterDescription').textContent = footerDesc;
    
    // 2. 社交链接
    const socialLinksContainer = document.getElementById('previewSocialLinks');
    socialLinksContainer.innerHTML = '';
    
    const socialLinks = [
        { id: 'githubUrl', icon: 'fab fa-github', platform: 'GitHub' },
        { id: 'weiboUrl', icon: 'fab fa-weibo', platform: '微博' },
        { id: 'zhihuUrl', icon: 'fab fa-zhihu', platform: '知乎' },
        { id: 'linkedinUrl', icon: 'fab fa-linkedin', platform: 'LinkedIn' }
    ];
    
    socialLinks.forEach(link => {
        const url = document.getElementById(link.id).value.trim();
        if (url && url !== 'https://example.com') {
            const a = document.createElement('a');
            a.href = url;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.title = link.platform;
            
            const i = document.createElement('i');
            i.className = link.icon;
            
            a.appendChild(i);
            socialLinksContainer.appendChild(a);
        }
    });
    
    // 3. 快速链接
    const quickLinksContainer = document.getElementById('previewQuickLinks');
    quickLinksContainer.innerHTML = '';
    
    document.querySelectorAll('#quickLinksContainer .footer-link-item').forEach(item => {
        const nameInput = item.querySelector('.quick-link-name');
        const urlInput = item.querySelector('.quick-link-url');
        if (nameInput && urlInput && nameInput.value && urlInput.value) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = urlInput.value.trim();
            a.target = '_blank';
            a.textContent = nameInput.value.trim();
            li.appendChild(a);
            quickLinksContainer.appendChild(li);
        }
    });
    
    // 4. 法律声明链接
    const legalLinksContainer = document.getElementById('previewLegalLinks');
    legalLinksContainer.innerHTML = '';
    
    document.querySelectorAll('#legalLinksContainer .footer-link-item').forEach(item => {
        const nameInput = item.querySelector('.legal-link-name');
        const urlInput = item.querySelector('.legal-link-url');
        if (nameInput && urlInput && nameInput.value && urlInput.value) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = urlInput.value.trim();
            a.target = '_blank';
            a.textContent = nameInput.value.trim();
            li.appendChild(a);
            legalLinksContainer.appendChild(li);
        }
    });
    
    // 5. 合规声明链接
    const complianceLinksContainer = document.getElementById('previewComplianceLinks');
    complianceLinksContainer.innerHTML = '';
    
    // 复用法律声明链接
    document.querySelectorAll('#legalLinksContainer .footer-link-item').forEach(item => {
        const nameInput = item.querySelector('.legal-link-name');
        const urlInput = item.querySelector('.legal-link-url');
        if (nameInput && urlInput && nameInput.value && urlInput.value) {
            const a = document.createElement('a');
            a.href = urlInput.value.trim();
            a.target = '_blank';
            a.textContent = nameInput.value.trim();
            complianceLinksContainer.appendChild(a);
        }
    });
    
    // 6. 版权信息
    const copyrightText = document.getElementById('footerCopyright').value.trim() || '© 2026 zcfi.cn 版权所有';
    document.getElementById('previewCopyright').innerHTML = copyrightText;
}

// 全屏预览
function openFullscreenPreview(type) {
    const modal = document.getElementById('fullscreenPreviewModal');
    const title = document.getElementById('fullscreenPreviewTitle');
    const content = document.getElementById('fullscreenPreviewContent');
    
    title.textContent = getFullscreenPreviewTitle(type);
    
    let previewHtml = '';
    switch(type) {
        case 'privacy':
            previewHtml = `<div style="padding: 20px; background: white;">
                <h2>${escapeHtml(document.getElementById('privacyTitle').value || '隐私政策')}</h2>
                <div>${document.getElementById('privacyContent').value || '<p>暂无内容</p>'}</div>
            </div>`;
            break;
        case 'terms':
            previewHtml = `<div style="padding: 20px; background: white;">
                <h2>${escapeHtml(document.getElementById('termsTitle').value || '使用条款')}</h2>
                <div>${document.getElementById('termsContent').value || '<p>暂无内容</p>'}</div>
            </div>`;
            break;
        case 'copyright':
            previewHtml = `<div style="padding: 20px; background: white;">
                <h2>${escapeHtml(document.getElementById('copyrightTitle').value || '版权声明')}</h2>
                <div>${document.getElementById('copyrightContent').value || '<p>暂无内容</p>'}</div>
            </div>`;
            break;
        case 'footer':
            previewHtml = `
            <div style="padding: 20px;">
                ${document.querySelector('.preview-footer').outerHTML}
            </div>
            `;
            break;
    }
    
    content.innerHTML = previewHtml;
    modal.classList.add('show');
    
    // 初始化预览中的交互
    if (type === 'footer') {
        // 页脚预览不需要特殊交互
    }
}

function closeFullscreenPreview() {
    document.getElementById('fullscreenPreviewModal').classList.remove('show');
}

function getFullscreenPreviewTitle(type) {
    const titles = {
        'privacy': '隐私政策预览',
        'terms': '使用条款预览',
        'copyright': '版权声明预览',
        'footer': '页脚全屏预览'
    };
    return titles[type] || '预览';
}

// 保存当前部分
function saveCurrentSection(section) {
    if (isSaving) {
        showResult('info', '请稍候', '正在保存中，请勿重复提交。');
        return;
    }
    
    // 收集当前部分的数据
    const sectionData = {};
    switch(section) {
        case 'site-info':
            const siteName = document.getElementById('siteName').value.trim();
            const siteDescription = document.getElementById('siteDescription').value.trim();
            if (!siteName || !siteDescription) {
                showResult('error', '输入错误', '请填写网站名称和描述');
                return;
            }
            sectionData.site = {
                name: siteName,
                description: siteDescription,
                keywords: document.getElementById('siteKeywords').value.trim(),
                adminEmail: document.getElementById('adminEmail').value.trim(),
                lastUpdated: new Date().toISOString()
            };
            break;
            
        case 'privacy':
            const privacyTitle = document.getElementById('privacyTitle').value.trim();
            const privacyContent = document.getElementById('privacyContent').value.trim();
            if (!privacyTitle || !privacyContent) {
                showResult('error', '输入错误', '请填写页面标题和内容');
                return;
            }
            sectionData.privacy = {
                title: privacyTitle,
                content: privacyContent,
                enabled: document.getElementById('privacyEnabled').checked,
                lastUpdated: new Date().toISOString()
            };
            break;
            
        case 'terms':
            const termsTitle = document.getElementById('termsTitle').value.trim();
            const termsContent = document.getElementById('termsContent').value.trim();
            if (!termsTitle || !termsContent) {
                showResult('error', '输入错误', '请填写页面标题和内容');
                return;
            }
            sectionData.terms = {
                title: termsTitle,
                content: termsContent,
                enabled: document.getElementById('termsEnabled').checked,
                lastUpdated: new Date().toISOString()
            };
            break;
            
        case 'copyright':
            const copyrightTitle = document.getElementById('copyrightTitle').value.trim();
            const copyrightContent = document.getElementById('copyrightContent').value.trim();
            if (!copyrightTitle || !copyrightContent) {
                showResult('error', '输入错误', '请填写页面标题和内容');
                return;
            }
            sectionData.copyright = {
                title: copyrightTitle,
                content: copyrightContent,
                enabled: document.getElementById('copyrightEnabled').checked,
                lastUpdated: new Date().toISOString()
            };
            break;
            
        case 'navigation':
            const navItems = [];
            
            // 确保首页项存在
            navItems.push({
                name: '首页',
                url: HOME_PAGE_URL,
                order: 1,
                fixed: true
            });
            
            // 添加其他项
            document.querySelectorAll('.nav-item-row:not(.homepage-item)').forEach(row => {
                const nameInput = row.querySelector('.nav-item-name');
                const urlInput = row.querySelector('.nav-item-url');
                const orderInput = row.querySelector('input[name="navOrder"]');
                if (nameInput && urlInput && nameInput.value && urlInput.value) {
                    // 验证URL
                    if (!validateUrl(urlInput)) {
                        showResult('error', 'URL无效', `导航项 "${nameInput.value}" 的URL无效`);
                        throw new Error('无效URL');
                    }
                    
                    navItems.push({
                        name: nameInput.value.trim(),
                        url: urlInput.value.trim(),
                        order: parseInt(orderInput?.value || '0'),
                        fixed: false
                    });
                }
            });
            
            // 按order排序
            navItems.sort((a, b) => a.order - b.order);
            
            sectionData.navigation = {
                items: navItems,
                lastUpdated: new Date().toISOString()
            };
            break;
            
        case 'footer':
            // 收集完整的页脚配置
            const footerDesc = document.getElementById('footerDescription').value.trim();
            const copyrightText = document.getElementById('footerCopyright').value.trim();
            
            if (!footerDesc || !copyrightText) {
                showResult('error', '输入错误', '请填写页脚描述和版权信息');
                return;
            }
            
            // 收集快速链接
            const quickLinks = [];
            document.querySelectorAll('#quickLinksContainer .footer-link-item').forEach(item => {
                const nameInput = item.querySelector('.quick-link-name');
                const urlInput = item.querySelector('.quick-link-url');
                if (nameInput && urlInput && nameInput.value && urlInput.value) {
                    // 验证URL
                    if (!validateUrl(urlInput)) {
                        showResult('error', 'URL无效', `快速链接 "${nameInput.value}" 的URL无效`);
                        throw new Error('无效URL');
                    }
                    
                    quickLinks.push({
                        name: nameInput.value.trim(),
                        url: urlInput.value.trim()
                    });
                }
            });
            
            // 收集法律声明链接
            const legalLinks = [];
            document.querySelectorAll('#legalLinksContainer .footer-link-item').forEach(item => {
                const nameInput = item.querySelector('.legal-link-name');
                const urlInput = item.querySelector('.legal-link-url');
                if (nameInput && urlInput && nameInput.value && urlInput.value) {
                    // 验证URL
                    if (!validateUrl(urlInput)) {
                        showResult('error', 'URL无效', `法律声明链接 "${nameInput.value}" 的URL无效`);
                        throw new Error('无效URL');
                    }
                    
                    legalLinks.push({
                        name: nameInput.value.trim(),
                        url: urlInput.value.trim()
                    });
                }
            });
            
            // 收集社交链接
            const socialLinks = {
                github: document.getElementById('githubUrl').value.trim(),
                weibo: document.getElementById('weiboUrl').value.trim(),
                zhihu: document.getElementById('zhihuUrl').value.trim(),
                linkedin: document.getElementById('linkedinUrl').value.trim()
            };
            
            // 验证非空的社交链接
            ['github', 'weibo', 'zhihu', 'linkedin'].forEach(socialKey => {
                if (socialLinks[socialKey] && !validateUrl({value: socialLinks[socialKey]})) {
                    showResult('error', 'URL无效', `社交媒体链接 "${socialKey}" 无效`);
                    throw new Error('无效URL');
                }
            });
            
            sectionData.footer = {
                description: footerDesc,
                quickLinks: quickLinks,
                legalLinks: legalLinks,
                social: socialLinks,
                copyright: copyrightText,
                lastUpdated: new Date().toISOString()
            };
            break;
    }
    
    // 显示确认弹窗
    document.getElementById('confirmMessage').textContent = `确定要保存${getSectionName(section)}吗？`;
    document.getElementById('confirmSaveBtn').dataset.section = section;
    document.getElementById('confirmSaveBtn').dataset.sectionData = JSON.stringify(sectionData);
    showModal('confirmModal');
}

// 执行保存
async function executeSave() {
    if (isSaving) {
        showResult('info', '请稍候', '正在保存中，请勿重复提交。');
        return;
    }
    
    const section = this.dataset.section;
    const sectionData = JSON.parse(this.dataset.sectionData);
    isSaving = true;
    retryCount = 0;
    
    try {
        showLoading('正在保存配置...');
        // 更新当前配置数据
        Object.assign(currentConfigData, sectionData);
        // 保存到Gist，带有重试机制
        await saveConfigToGistWithRetry(currentConfigData);
        hideLoading();
        showResult('success', '保存成功', `${getSectionName(section)}已成功保存。`);
        closeConfirmModal();
    } catch (error) {
        hideLoading();
        showResult('error', '保存失败', error.message);
    } finally {
        isSaving = false;
    }
}

// 带有重试机制的保存
async function saveConfigToGistWithRetry(configData, retry = 0) {
    try {
        return await saveConfigToGist(configData);
    } catch (error) {
        if (retry < MAX_RETRIES) {
            console.log(`保存失败，第${retry + 1}次重试...`);
            await delay(1000 * (retry + 1)); // 延迟重试
            return await saveConfigToGistWithRetry(configData, retry + 1);
        } else {
            throw error;
        }
    }
}

// 延迟函数
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// 保存到Gist（使用代理绕过CORS限制）
async function saveConfigToGist(configData) {
    try {
        // 使用新的 CORS 代理
        const proxyUrl = 'https://corsproxy.io/?';
        const encodedUrl = encodeURIComponent(CONFIG_GIST_URL);
        
        // 先获取现有Gist信息
        const gistResponse = await fetch(`${proxyUrl}${encodedUrl}`, {
            headers: {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });
        
        let gistExists = gistResponse.ok;
        
        // 准备Gist数据
        const gistData = {
            description: '网站配置数据',
            files: {
                'config.json': {
                    content: JSON.stringify(configData, null, 2)
                }
            }
        };
        
        // 发送请求
        let updateResponse;
        if (gistExists) {
            // 更新现有Gist
            updateResponse = await fetch(`${proxyUrl}${encodedUrl}`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(gistData)
            });
        } else {
            // 创建新Gist
            const createResponse = await fetch(`${proxyUrl}https%3A%2F%2Fapi.github.com%2Fgists`, {
                method: 'POST',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(gistData)
            });
            
            if (!createResponse.ok) {
                const errorText = await createResponse.text();
                console.error('GitHub API错误:', errorText);
                throw new Error(`创建失败: ${createResponse.status} ${createResponse.statusText}`);
            }
            return true;
        }
        
        if (!updateResponse.ok) {
            const errorText = await updateResponse.text();
            console.error('GitHub API错误:', errorText);
            throw new Error(`保存失败: ${updateResponse.status} ${updateResponse.statusText}`);
        }
        
        return true;
    } catch (error) {
        console.error('保存配置到Gist失败:', error);
        throw error;
    }
}

// 备份配置
async function backupConfig() {
    try {
        showLoading('正在创建备份...');
        
        // 收集当前所有配置数据
        const backupData = {
            site: {
                name: document.getElementById('siteName').value.trim(),
                description: document.getElementById('siteDescription').value.trim(),
                keywords: document.getElementById('siteKeywords').value.trim(),
                adminEmail: document.getElementById('adminEmail').value.trim()
            },
            privacy: {
                title: document.getElementById('privacyTitle').value.trim(),
                content: document.getElementById('privacyContent').value.trim(),
                enabled: document.getElementById('privacyEnabled').checked
            },
            terms: {
                title: document.getElementById('termsTitle').value.trim(),
                content: document.getElementById('termsContent').value.trim(),
                enabled: document.getElementById('termsEnabled').checked
            },
            copyright: {
                title: document.getElementById('copyrightTitle').value.trim(),
                content: document.getElementById('copyrightContent').value.trim(),
                enabled: document.getElementById('copyrightEnabled').checked
            },
            navigation: {
                items: []
            },
            footer: {
                description: document.getElementById('footerDescription').value.trim(),
                quickLinks: [],
                legalLinks: [],
                social: {
                    github: document.getElementById('githubUrl').value.trim(),
                    weibo: document.getElementById('weiboUrl').value.trim(),
                    zhihu: document.getElementById('zhihuUrl').value.trim(),
                    linkedin: document.getElementById('linkedinUrl').value.trim()
                },
                copyright: document.getElementById('footerCopyright').value.trim()
            }
        };
        
        // 收集导航项
        document.querySelectorAll('.nav-item-row:not(.homepage-item)').forEach(row => {
            const nameInput = row.querySelector('.nav-item-name');
            const urlInput = row.querySelector('.nav-item-url');
            const orderInput = row.querySelector('input[name="navOrder"]');
            if (nameInput && urlInput && nameInput.value && urlInput.value) {
                backupData.navigation.items.push({
                    name: nameInput.value.trim(),
                    url: urlInput.value.trim(),
                    order: parseInt(orderInput?.value || '0')
                });
            }
        });
        
        // 收集快速链接
        document.querySelectorAll('#quickLinksContainer .footer-link-item').forEach(item => {
            const nameInput = item.querySelector('.quick-link-name');
            const urlInput = item.querySelector('.quick-link-url');
            if (nameInput && urlInput && nameInput.value && urlInput.value) {
                backupData.footer.quickLinks.push({
                    name: nameInput.value.trim(),
                    url: urlInput.value.trim()
                });
            }
        });
        
        // 收集法律声明链接
        document.querySelectorAll('#legalLinksContainer .footer-link-item').forEach(item => {
            const nameInput = item.querySelector('.legal-link-name');
            const urlInput = item.querySelector('.legal-link-url');
            if (nameInput && urlInput && nameInput.value && urlInput.value) {
                backupData.footer.legalLinks.push({
                    name: nameInput.value.trim(),
                    url: urlInput.value.trim()
                });
            }
        });
        
        // 创建备份文件
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const backupBlob = new Blob(
            [JSON.stringify(backupData, null, 2)],
            { type: 'application/json' }
        );
        
        // 下载备份文件
        const backupUrl = URL.createObjectURL(backupBlob);
        const downloadLink = document.createElement('a');
        downloadLink.href = backupUrl;
        downloadLink.download = `config-backup-${timestamp}.json`;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
        URL.revokeObjectURL(backupUrl);
        
        hideLoading();
        showResult('success', '备份成功', '配置文件已下载到您的设备。');
    } catch (error) {
        hideLoading();
        showResult('error', '备份失败', error.message);
    }
}

// 重置当前部分
function resetCurrentSection(section) {
    if (confirm(`确定要重置${getSectionName(section)}吗？所有未保存的更改将丢失。`)) {
        // 重新从当前配置数据填充表单
        populateSectionFromConfig(section);
    }
}

// 从配置数据填充部分
function populateSectionFromConfig(section) {
    switch(section) {
        case 'site-info':
            if (currentConfigData.site) {
                document.getElementById('siteName').value = currentConfigData.site.name || '';
                document.getElementById('siteDescription').value = currentConfigData.site.description || '';
                document.getElementById('siteKeywords').value = currentConfigData.site.keywords || '';
                document.getElementById('adminEmail').value = currentConfigData.site.adminEmail || '';
            }
            break;
            
        case 'privacy':
            if (currentConfigData.privacy) {
                document.getElementById('privacyTitle').value = currentConfigData.privacy.title || '';
                document.getElementById('privacyContent').value = currentConfigData.privacy.content || '';
                document.getElementById('privacyEnabled').checked = currentConfigData.privacy.enabled !== false;
                previewContent('privacy');
            }
            break;
            
        case 'terms':
            if (currentConfigData.terms) {
                document.getElementById('termsTitle').value = currentConfigData.terms.title || '';
                document.getElementById('termsContent').value = currentConfigData.terms.content || '';
                document.getElementById('termsEnabled').checked = currentConfigData.terms.enabled !== false;
                previewContent('terms');
            }
            break;
            
        case 'copyright':
            if (currentConfigData.copyright) {
                document.getElementById('copyrightTitle').value = currentConfigData.copyright.title || '';
                document.getElementById('copyrightContent').value = currentConfigData.copyright.content || '';
                document.getElementById('copyrightEnabled').checked = currentConfigData.copyright.enabled !== false;
                previewContent('copyright');
            }
            break;
            
        case 'navigation':
            if (currentConfigData.navigation) {
                populateNavigationForm(currentConfigData.navigation.items || []);
                previewNavigation();
            }
            break;
            
        case 'footer':
            if (currentConfigData.footer) {
                populateFormWithConfig(currentConfigData);
                previewFooter();
            }
            break;
    }
}

// 预览内容
function previewContent(type) {
    let content = '';
    let title = '';
    switch(type) {
        case 'privacy':
            content = document.getElementById('privacyContent').value;
            title = document.getElementById('privacyTitle').value || '隐私政策';
            break;
            
        case 'terms':
            content = document.getElementById('termsContent').value;
            title = document.getElementById('termsTitle').value || '使用条款';
            break;
            
        case 'copyright':
            content = document.getElementById('copyrightContent').value;
            title = document.getElementById('copyrightTitle').value || '版权声明';
            break;
    }
    
    const previewElement = document.getElementById(`${type}Preview`);
    if (previewElement) {
        previewElement.innerHTML = `
        <h3>${escapeHtml(title)}</h3>
        <div>${content || '<p style="color: #999;">暂无内容</p>'}</div>
        `;
    }
}

// 插入HTML标签
function insertTag(textareaId, tag) {
    const textarea = document.getElementById(textareaId);
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    let formattedText = '';
    
    switch(tag) {
        case 'h3':
            formattedText = `<h3>${selectedText || '小标题'}</h3>`;
            break;
        case 'p':
            formattedText = `<p>${selectedText || '段落内容'}</p>`;
            break;
        case 'strong':
            formattedText = `<strong>${selectedText || '加粗文本'}</strong>`;
            break;
        case 'em':
            formattedText = `<em>${selectedText || '斜体文本'}</em>`;
            break;
        case 'ul':
            formattedText = `<ul>
    <li>列表项1</li>
    <li>列表项2</li>
</ul>`;
            break;
        case 'li':
            formattedText = `<li>${selectedText || '列表项内容'}</li>`;
            break;
        case 'a':
            const url = prompt('请输入链接地址:', 'https://');
            if (url) {
                const linkText = selectedText || '链接文本';
                formattedText = `<a href="${escapeHtml(url)}" target="_blank">${escapeHtml(linkText)}</a>`;
            } else {
                return;
            }
            break;
    }
    
    textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
    // 重新聚焦并设置光标位置
    textarea.focus();
    textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
    // 触发输入事件以更新预览
    textarea.dispatchEvent(new Event('input'));
}

// 文本格式化工具
function formatText(textareaId, format) {
    const textarea = document.getElementById(textareaId);
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    let formattedText = '';
    
    switch(format) {
        case 'bold':
            formattedText = `<strong>${selectedText}</strong>`;
            break;
        case 'italic':
            formattedText = `<em>${selectedText}</em>`;
            break;
        case 'underline':
            formattedText = `<u>${selectedText}</u>`;
            break;
        case 'link':
            const url = prompt('请输入链接地址:', 'https://');
            if (url) {
                const linkText = selectedText || '链接文本';
                formattedText = `<a href="${escapeHtml(url)}" target="_blank">${escapeHtml(linkText)}</a>`;
            } else {
                return;
            }
            break;
        case 'list':
            const listItems = selectedText.split('\n').filter(item => item.trim());
            if (listItems.length > 0) {
                formattedText = `<ul>\n${listItems.map(item => `  <li>${item}</li>`).join('\n')}\n</ul>`;
            } else {
                formattedText = `<ul>
    <li>列表项1</li>
    <li>列表项2</li>
</ul>`;
            }
            break;
        case 'quote':
            formattedText = `<blockquote>${selectedText || '引用内容'}</blockquote>`;
            break;
    }
    
    textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
    // 重新聚焦并设置光标位置
    textarea.focus();
    textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
    // 触发输入事件以更新预览
    textarea.dispatchEvent(new Event('input'));
}

// 获取部分名称
function getSectionName(section) {
    const names = {
        'site-info': '网站信息',
        'privacy': '隐私政策',
        'terms': '使用条款',
        'copyright': '版权声明',
        'navigation': '导航栏配置',
        'footer': '页脚配置'
    };
    return names[section] || '配置';
}

// 弹窗控制函数
function showModal(modalId) {
    document.getElementById(modalId).classList.add('show');
}

function hideModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
}

function closeConfirmModal() {
    hideModal('confirmModal');
}

function closeResultModal() {
    hideModal('resultModal');
}

function showLoading(message = '正在处理您的请求，请稍候...') {
    document.getElementById('loadingMessage').textContent = message;
    showModal('loadingModal');
}

function hideLoading() {
    hideModal('loadingModal');
}

function showResult(type, title, message) {
    const icon = document.getElementById('resultIcon');
    if (type === 'success') {
        icon.className = 'fas fa-check-circle';
        icon.style.color = '#28a745';
    } else if (type === 'error') {
        icon.className = 'fas fa-exclamation-circle';
        icon.style.color = '#dc3545';
    } else {
        icon.className = 'fas fa-info-circle';
        icon.style.color = '#4a6fa5';
    }
    document.getElementById('resultTitle').textContent = title;
    document.getElementById('resultMessage').textContent = message;
    showModal('resultModal');
}

// HTML转义辅助函数
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// 页面卸载时清除敏感信息
window.addEventListener('beforeunload', () => {
    sessionStorage.removeItem('admin_token');
    sessionStorage.removeItem('admin_verified');
});
</script>
</body>
</html>
