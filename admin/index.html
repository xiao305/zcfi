<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ç®¡ç†åå° | zcfi.cn</title>
<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg">
<link rel="icon" type="image/png" sizes="96x96" href="../favicon/favicon-96x96.png">
<link rel="icon" type="image/x-icon" href="../favicon/favicon.ico">
<!-- å†…è” Font Awesome æ›¿ä»£ CDN (é¿å…è·Ÿè¸ªé˜»æ­¢é—®é¢˜) -->
<style>
/* ç®€åŒ–çš„ Font Awesome æ›¿ä»£æ–¹æ¡ˆ */
.fas, .fab {
font-family: 'Font Awesome 5 Free';
font-weight: 900;
font-style: normal;
display: inline-block;
font-variant: normal;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
line-height: 1;
}
.fas.fa-check-circle:before { content: "âœ“"; color: #28a745; }
.fas.fa-exclamation-circle:before { content: "!"; color: #dc3545; }
.fas.fa-times-circle:before { content: "âœ—"; color: #dc3545; }
.fas.fa-info-circle:before { content: "i"; color: #4a6fa5; }
.fas.fa-exclamation-triangle:before { content: "âš "; color: #ffc107; }
.fas.fa-eye:before { content: "ğŸ‘"; }
.fas.fa-eye-slash:before { content: "ğŸ‘â€ğŸ—¨"; }
.fas.fa-spinner:before { content: "â†»"; animation: spin 1s linear infinite; }
.fas.fa-arrow-left:before { content: "â†"; }
.fas.fa-sign-in-alt:before { content: "â†’"; }
.fas.fa-lock:before { content: "ğŸ”’"; }
.fas.fa-check:before { content: "âœ“"; }
.fas.fa-times:before { content: "âœ—"; }
.fab.fa-github:before { content: "G"; }
.fab.fa-weibo:before { content: "W"; }
.fab.fa-zhihu:before { content: "Z"; }
.fab.fa-linkedin:before { content: "L"; }
.fas.fa-blog:before { content: "ğŸ“"; }
.fas.fa-briefcase:before { content: "ğŸ’¼"; }
.fas.fa-comments:before { content: "ğŸ’¬"; }
.fas.fa-cog:before { content: "âš™"; }
.fas.fa-sync-alt:before { content: "ğŸ”„"; }
.fas.fa-download:before { content: "â†“"; }
.fas.fa-arrow-up:before { content: "â†‘"; }
.fas.fa-arrow-down:before { content: "â†“"; }
.fas.fa-trash:before { content: "ğŸ—‘"; }
.fas.fa-edit:before { content: "âœ"; }
.fas.fa-question-circle:before { content: "?"; }
.fas.fa-history:before { content: "ğŸ•’"; }
.fas.fa-clock:before { content: "â°"; }
.fas.fa-expand:before { content: "â¤¢"; }
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
</style>
<!-- åå°å…¬å…±CSS -->
<link rel="stylesheet" href="assets/css/admin-common.css">
<style>
/* ç™»å½•é¡µé¢ç‰¹å®šæ ·å¼ */
.login-container {
background: white;
border-radius: 20px;
box-shadow: 0 15px 50px rgba(0,0,0,0.3);
width: 100%;
max-width: 600px;
padding: 40px;
text-align: center;
}
.login-logo {
font-size: 36px;
font-weight: 700;
color: #4a6fa5;
margin-bottom: 30px;
text-decoration: none;
display: inline-block;
}
.login-logo span {
color: #28a745;
}
.login-title {
color: #333;
margin-bottom: 25px;
font-size: 24px;
}
.token-input {
position: relative;
margin-bottom: 30px;
}
.token-input input {
width: 100%;
padding: 15px 20px;
border: 2px solid #dee2e6;
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
}
.token-input input:focus {
outline: none;
border-color: #4a6fa5;
box-shadow: 0 0 0 4px rgba(74, 111, 165, 0.15);
}
.modules-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 20px;
margin-top: 30px;
}
.module-card {
background: #f8f9fa;
border: 2px solid #e9ecef;
border-radius: 15px;
padding: 25px 15px;
cursor: pointer;
transition: all 0.3s ease;
text-align: center;
}
.module-card:hover {
transform: translateY(-5px);
border-color: #4a6fa5;
box-shadow: 0 8px 20px rgba(74, 111, 165, 0.2);
background: #ffffff;
}
.module-card.selected {
border-color: #4a6fa5;
background: #ffffff;
box-shadow: 0 8px 20px rgba(74, 111, 165, 0.25);
}
.module-icon {
font-size: 32px;
color: #4a6fa5;
margin-bottom: 15px;
transition: transform 0.3s ease;
}
.module-card:hover .module-icon {
transform: scale(1.2);
}
.module-title {
font-weight: 600;
color: #333;
font-size: 16px;
}
.login-btn {
width: 100%;
padding: 16px;
background: #4a6fa5;
color: white;
border: none;
border-radius: 12px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 25px;
}
.login-btn:hover {
background: #3a5a80;
transform: translateY(-2px);
}
.login-btn:disabled {
background: #6c757d;
cursor: not-allowed;
transform: none;
}
/* æ¨¡å—è¯´æ˜æ ·å¼ */
.module-description {
font-size: 13px;
color: #6c757d;
margin-top: 8px;
line-height: 1.4;
min-height: 36px;
}
/* æƒé™æ˜¾ç¤ºæ ·å¼ */
.permissions-section {
margin-top: 20px;
padding: 15px;
background: #f8f9fa;
border-radius: 8px;
text-align: left;
}
.permission-item {
display: flex;
align-items: center;
margin-bottom: 8px;
}
.permission-icon {
width: 24px;
height: 24px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
margin-right: 10px;
font-size: 14px;
}
.permission-granted {
background-color: #28a745;
color: white;
}
.permission-denied {
background-color: #dc3545;
color: white;
}
.permission-name {
font-weight: 500;
}
/* TokençŠ¶æ€æç¤ºæ ·å¼ */
.token-status-section {
margin-top: 20px;
padding: 15px;
border-radius: 8px;
background: #e3f2fd;
border: 1px solid #bbdefb;
}
.token-status-warning {
background: #fff8e1;
border-color: #ffecb3;
}
.token-status-alert {
background: #ffebee;
border-color: #ffcdd2;
}
.status-label {
font-weight: 600;
margin-bottom: 5px;
display: flex;
align-items: center;
gap: 8px;
}
.status-message {
font-size: 14px;
line-height: 1.5;
}
.status-good {
color: #28a745;
}
.status-warning {
color: #ffc107;
}
.status-bad {
color: #dc3545;
}
/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
.modules-grid {
grid-template-columns: 1fr;
}
.login-container {
padding: 30px 20px;
}
}
/* ä¿®æ­£ï¼šè¡¨å•å®¹å™¨ */
.login-form {
width: 100%;
}
</style>
</head>
<body class="admin-body">
<div class="admin-container" style="max-width: 600px;">
<div class="login-container">
<a href="https://zcfi.cn" class="login-logo">zcfi<span>.</span>cn</a>
<h2 class="login-title"><i class="fas fa-lock"></i> ç®¡ç†åå°ç™»å½•</h2>
<!-- ä¿®æ­£ï¼šå°†è¡¨å•å…ƒç´ åŒ…è£¹åœ¨formæ ‡ç­¾å†… -->
<form class="login-form" id="loginForm">
<div class="token-input">
<input type="password" id="token" placeholder="è¯·è¾“å…¥ GitHub Personal Access Token (ghp_xxx...)" autocomplete="off">
</div>
<div class="modules-grid">
<!-- åšå®¢ç®¡ç† -->
<div class="module-card" data-module="blog">
<div class="module-icon">
<i class="fas fa-blog"></i>
</div>
<div class="module-title">åšå®¢ç®¡ç†</div>
<div class="module-description">ç®¡ç†åšå®¢æ–‡ç« ï¼Œç¼–è¾‘å‘å¸ƒæ–°å†…å®¹</div>
</div>
<!-- ä½œå“é›†ç®¡ç† -->
<div class="module-card" data-module="portfolio">
<div class="module-icon">
<i class="fas fa-briefcase"></i>
</div>
<div class="module-title">ä½œå“é›†ç®¡ç†</div>
<div class="module-description">ç®¡ç†é¡¹ç›®ä½œå“ï¼Œè®¾ç½®é¦–é¡µå±•ç¤º</div>
</div>
<!-- ç•™è¨€ç®¡ç† -->
<div class="module-card" data-module="contact">
<div class="module-icon">
<i class="fas fa-comments"></i>
</div>
<div class="module-title">ç•™è¨€ç®¡ç†</div>
<div class="module-description">æŸ¥çœ‹å’Œå¤„ç†è®¿å®¢ç•™è¨€</div>
</div>
<!-- é…ç½®é¢æ¿ -->
<div class="module-card" data-module="config">
<div class="module-icon">
<i class="fas fa-cog"></i>
</div>
<div class="module-title">é…ç½®é¢æ¿</div>
<div class="module-description">ç½‘ç«™è®¾ç½®å’Œæ³•å¾‹å£°æ˜é…ç½®</div>
</div>
</div>
<button class="login-btn" id="enterBtn" disabled>
<i class="fas fa-sign-in-alt"></i> è¿›å…¥ç®¡ç†
</button>
</form>
<!-- Tokenä½¿ç”¨è¯´æ˜ -->
<div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #6c757d;">
<p style="margin-bottom: 8px;"><i class="fas fa-info-circle" style="color: #4a6fa5;"></i> <strong>Token å®‰å…¨è¯´æ˜ï¼š</strong></p>
<p style="font-size: 13px; line-height: 1.5;">
1. æ¯æ¬¡ç™»å½•éƒ½éœ€è¦<strong>é‡æ–°è¾“å…¥</strong>Tokenï¼Œç³»ç»Ÿä¸ä¼šä¿å­˜æ‚¨çš„Token<br>
2. å‰å¾€ <a href="https://github.com/settings/tokens" target="_blank" style="color: #4a6fa5; text-decoration: none;">GitHub Tokenè®¾ç½®</a> åˆ›å»ºæ–°Token<br>
3. åŸºç¡€åŠŸèƒ½éœ€è¦å‹¾é€‰ <code>gist</code> æƒé™<br>
4. é«˜çº§åŠŸèƒ½ï¼ˆå¦‚è‡ªåŠ¨ç”Ÿæˆåšå®¢é¡µé¢ï¼‰éœ€è¦é¢å¤–å‹¾é€‰ <code>repo</code> æƒé™<br>
5. <strong>å®‰å…¨æç¤ºï¼š</strong> ä¸ºTokenè®¾ç½®åˆç†çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨åç«‹å³ä»GitHubåˆ é™¤
</p>
</div>
</div>
</div>
<!-- ä½¿ç”¨å…¬å…±å¼¹çª—æ ·å¼ -->
<div class="custom-modal" id="customModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-info-circle"></i>
</div>
<div class="modal-title">æç¤º</div>
<div class="modal-message" id="modalMessage">æ¶ˆæ¯å†…å®¹</div>
<div class="modal-buttons">
<button class="modal-btn btn-primary" id="modalConfirmBtn">ç¡®å®š</button>
<button class="modal-btn btn-secondary" id="modalCancelBtn" style="display:none;">å–æ¶ˆ</button>
</div>
</div>
</div>
<!-- æƒé™ç¡®è®¤å¼¹çª— -->
<div class="custom-modal" id="permissionsModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-shield-alt"></i>
</div>
<div class="modal-title" id="permissionsModalTitle">æƒé™éªŒè¯ç»“æœ</div>
<div class="modal-message">
<p id="permissionsModalMessage">æ‚¨çš„Tokenæƒé™éªŒè¯å·²å®Œæˆï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†ä¿¡æ¯ï¼š</p>
<div class="permissions-section" id="permissionsList">
<!-- æƒé™åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
</div>
<!-- TokençŠ¶æ€ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
<div class="token-status-section" id="tokenStatusSection">
<p class="status-label">
<i class="fas fa-check-circle status-good"></i> <span id="statusTitle">Token çŠ¶æ€: æ­£å¸¸</span>
</p>
<p class="status-message" id="statusMessage">
Token å½“å‰æœ‰æ•ˆï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰æˆæƒåŠŸèƒ½ã€‚
</p>
</div>
<p style="margin-top: 15px; font-weight: 500;">å®‰å…¨æé†’ï¼š</p>
<ul style="text-align: left; margin-top: 10px; margin-bottom: 20px;">
<li>ç³»ç»Ÿ<strong>ä¸ä¼šä¿å­˜</strong>æ‚¨çš„Tokenï¼Œå…³é—­é¡µé¢åéœ€è¦é‡æ–°è¾“å…¥</li>
<li>ç¼ºå°‘<span style="color: #dc3545; font-weight: 600;">gist</span>æƒé™å°†æ— æ³•ä½¿ç”¨ä»»ä½•åå°åŠŸèƒ½</li>
<li>ç¼ºå°‘<span style="color: #4a6fa5; font-weight: 600;">repo</span>æƒé™å°†æ— æ³•ä½¿ç”¨<span style="color: #4a6fa5;">è‡ªåŠ¨ç”Ÿæˆåšå®¢é¡µé¢</span>ç­‰é«˜çº§åŠŸèƒ½</li>
<li>ä½¿ç”¨å®Œæ¯•åï¼Œå»ºè®®ç«‹å³ä» <a href="https://github.com/settings/tokens" target="_blank" style="color: #4a6fa5; text-decoration: none;">GitHub Tokenè®¾ç½®</a> åˆ é™¤æ­¤Token</li>
</ul>
</div>
<div class="modal-buttons">
<button class="modal-btn btn-secondary" id="permissionsCancelBtn">è¿”å›</button>
<button class="modal-btn btn-primary" id="permissionsConfirmBtn" style="display:none;">ç¡®è®¤å¹¶ç»§ç»­</button>
</div>
</div>
</div>
<script>
// å®‰å…¨æ¸…ç†ï¼šé¡µé¢åŠ è½½æ—¶ç«‹å³æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„æ•æ„Ÿæ•°æ®
(function() {
// æ¸…é™¤æ‰€æœ‰ sessionStorage æ•°æ®
sessionStorage.clear();
// æ¸…é™¤æ‰€æœ‰ localStorage æ•°æ®
Object.keys(localStorage).forEach(key => {
if (key.toLowerCase().includes('token') || 
key.toLowerCase().includes('admin') || 
key.toLowerCase().includes('auth')) {
localStorage.removeItem(key);
}
});
// æ¸…é™¤è¾“å…¥æ¡†
setTimeout(() => {
if (document.getElementById('token')) {
document.getElementById('token').value = '';
}
}, 100);
})();
let selectedModule = null;
const BLOG_GIST_ID = '73cc78400c25eb9effed665e2c89843d';
const GIST_URL = `https://api.github.com/gists/${BLOG_GIST_ID}`;
const SCOPE_CHECK_URL = 'https://api.github.com';
// é¡µé¢åŠ è½½
document.addEventListener('DOMContentLoaded', () => {
setupEventListeners();
// ç¡®ä¿é¡µé¢åŠ è½½æ—¶æ²¡æœ‰æ®‹ç•™çš„token
document.getElementById('token').value = '';
updateEnterButton();
});
// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
function setupEventListeners() {
// é˜²æ­¢è¡¨å•é»˜è®¤æäº¤
document.getElementById('loginForm').addEventListener('submit', function(e) {
e.preventDefault();
if (!document.getElementById('enterBtn').disabled && selectedModule) {
validateAndLogin();
}
});
// æ¨¡å—é€‰æ‹©
document.querySelectorAll('.module-card').forEach(card => {
card.addEventListener('click', function() {
document.querySelectorAll('.module-card').forEach(c => c.classList.remove('selected'));
this.classList.add('selected');
selectedModule = this.dataset.module;
updateEnterButton();
});
});
// Token è¾“å…¥
document.getElementById('token').addEventListener('input', updateEnterButton);
// è¿›å…¥æŒ‰é’®
document.getElementById('enterBtn').addEventListener('click', validateAndLogin);
// å¼¹çª—æŒ‰é’®
document.getElementById('modalConfirmBtn').addEventListener('click', closeModal);
document.getElementById('modalCancelBtn').addEventListener('click', closeModal);
// æƒé™å¼¹çª—æŒ‰é’®
document.getElementById('permissionsCancelBtn').addEventListener('click', closePermissionsModal);
document.getElementById('permissionsConfirmBtn').addEventListener('click', confirmPermissionsAndNavigate);
// ç¦ç”¨æµè§ˆå™¨è‡ªåŠ¨å¡«å……
document.getElementById('token').setAttribute('autocomplete', 'off');
}
// æ›´æ–°æŒ‰é’®çŠ¶æ€
function updateEnterButton() {
const token = document.getElementById('token').value.trim();
const btn = document.getElementById('enterBtn');
btn.disabled = !(token && selectedModule);
}
// æ£€æŸ¥Tokenæƒé™
async function checkTokenPermissions(token) {
const permissions = {
gist: false,
repo: false
};
try {
// 1. æ£€æŸ¥gistæƒé™
const timestamp = new Date().getTime();
const gistResponse = await fetch(`${GIST_URL}?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});
if (gistResponse.ok) {
permissions.gist = true;
}
} catch (error) {
console.error('æ£€æŸ¥gistæƒé™å¤±è´¥:', error);
}
try {
// 2. æ£€æŸ¥repoæƒé™
const scopeResponse = await fetch(`${SCOPE_CHECK_URL}?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});
if (scopeResponse.ok) {
const scopesHeader = scopeResponse.headers.get('x-oauth-scopes');
if (scopesHeader) {
const scopes = scopesHeader.split(',').map(scope => scope.trim());
console.log('Token scopes:', scopes);
permissions.repo = scopes.some(scope => 
scope === 'repo' || 
scope.startsWith('repo:') || 
scope.includes('write')
);
}
}
} catch (error) {
console.error('æ£€æŸ¥repoæƒé™å¤±è´¥:', error);
}
return permissions;
}
// æ£€æŸ¥TokençŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æ•ˆï¼‰
async function checkTokenStatus(token) {
try {
// å°è¯•è·å–ç”¨æˆ·ä¿¡æ¯æ¥éªŒè¯tokençŠ¶æ€
const timestamp = new Date().getTime();
const response = await fetch(`https://api.github.com/user?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});
if (!response.ok) {
// Tokenæ— æ•ˆæˆ–æƒé™ä¸è¶³
return {
isValid: false,
status: 'invalid',
message: `Tokenæ— æ•ˆæˆ–æƒé™ä¸è¶³ã€‚çŠ¶æ€ç : ${response.status} ${response.statusText}`
};
}
// æ£€æŸ¥é€Ÿç‡é™åˆ¶
const rateLimitRemaining = response.headers.get('x-ratelimit-remaining');
const rateLimitReset = response.headers.get('x-ratelimit-reset');
if (rateLimitRemaining !== null && parseInt(rateLimitRemaining) === 0) {
const resetTime = new Date(parseInt(rateLimitReset) * 1000);
const now = new Date();
const minutesUntilReset = Math.ceil((resetTime - now) / (1000 * 60));
if (minutesUntilReset > 0) {
return {
isValid: true,
status: 'rate_limited',
message: `Tokenå½“å‰è¢«é€Ÿç‡é™åˆ¶ï¼Œå°†åœ¨çº¦${minutesUntilReset}åˆ†é’Ÿåæ¢å¤ã€‚è¯·ç¨åå†è¯•æˆ–è”ç³»GitHubæ”¯æŒã€‚`
};
}
}
// TokençŠ¶æ€è‰¯å¥½
return {
isValid: true,
status: 'good',
message: 'Tokenå½“å‰æœ‰æ•ˆï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰æˆæƒåŠŸèƒ½ã€‚'
};
} catch (error) {
console.error('æ£€æŸ¥TokençŠ¶æ€å¤±è´¥:', error);
return {
isValid: false,
status: 'error',
message: 'æ— æ³•éªŒè¯TokençŠ¶æ€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–Tokenæ˜¯å¦æ­£ç¡®ã€‚'
};
}
}
// æ¸²æŸ“TokençŠ¶æ€ä¿¡æ¯
function renderTokenStatusInfo(statusInfo) {
const statusSection = document.getElementById('tokenStatusSection');
const statusTitle = document.getElementById('statusTitle');
const statusMessage = document.getElementById('statusMessage');
const statusIcon = document.querySelector('.status-label i');
if (!statusSection || !statusTitle || !statusMessage || !statusIcon) {
console.error('æ— æ³•æ‰¾åˆ°TokençŠ¶æ€å…ƒç´ ï¼Œè·³è¿‡æ¸²æŸ“');
return;
}
if (statusInfo.status === 'good') {
statusSection.className = 'token-status-section';
statusTitle.innerHTML = '<i class="fas fa-check-circle status-good"></i> Token çŠ¶æ€: æ­£å¸¸';
statusMessage.className = 'status-message';
statusMessage.innerHTML = statusInfo.message;
statusIcon.className = 'fas fa-check-circle status-good';
} else if (statusInfo.status === 'rate_limited') {
statusSection.className = 'token-status-section token-status-warning';
statusTitle.innerHTML = '<i class="fas fa-exclamation-triangle status-warning"></i> Token çŠ¶æ€: é€Ÿç‡é™åˆ¶';
statusMessage.className = 'status-message status-warning';
statusMessage.innerHTML = statusInfo.message;
statusIcon.className = 'fas fa-exclamation-triangle status-warning';
} else {
statusSection.className = 'token-status-section token-status-alert';
statusTitle.innerHTML = '<i class="fas fa-times-circle status-bad"></i> Token çŠ¶æ€: æ— æ•ˆ';
statusMessage.className = 'status-message status-bad';
statusMessage.innerHTML = statusInfo.message;
statusIcon.className = 'fas fa-times-circle status-bad';
}
}
// éªŒè¯å’Œç™»å½•
async function validateAndLogin() {
const token = document.getElementById('token').value.trim();
if (!token.startsWith('ghp_')) {
// ä½¿ç”¨æƒé™å¼¹çª—æ˜¾ç¤ºé”™è¯¯
showPermissionsModal({
gist: false,
repo: false
}, {
isValid: false,
status: 'invalid',
message: 'Token å¿…é¡»ä»¥ "ghp_" å¼€å¤´'
});
return;
}
showLoadingModal('æ­£åœ¨éªŒè¯ Token...');
try {
const timestamp = new Date().getTime();
// éªŒè¯Token
const response = await fetch(`${GIST_URL}?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});
if (!response.ok) {
throw new Error(`éªŒè¯å¤±è´¥: ${response.status} ${response.statusText}`);
}
// éªŒè¯æˆåŠŸï¼Œæ£€æŸ¥è¯¦ç»†æƒé™
closeModal();
showLoadingModal('æ­£åœ¨æ£€æŸ¥æƒé™...');
const permissions = await checkTokenPermissions(token);
const statusInfo = await checkTokenStatus(token);
closeModal();
// æ˜¾ç¤ºæƒé™æ£€æŸ¥ç»“æœ
showPermissionsModal(permissions, statusInfo);
// ä¸´æ—¶ä¿å­˜tokenæ•°æ®
window.tempTokenData = {
token: token,
selectedModule: selectedModule,
permissions: permissions
};
} catch (error) {
console.error('Token éªŒè¯å¤±è´¥:', error);
// æ£€æŸ¥æ˜¯å¦æ˜¯CORSé—®é¢˜
if (error.message.includes('CORS') || error.message.includes('è·¨åŸŸ')) {
// å°è¯•ä½¿ç”¨JSONPæˆ–ä»£ç†
showPermissionsModal({
gist: false,
repo: false
}, {
isValid: false,
status: 'error',
message: 'CORSé™åˆ¶ï¼šè¯·ç¡®ä¿åœ¨GitHub Pagesä¸Šè®¿é—®æ­¤é¡µé¢ï¼Œæˆ–ä½¿ç”¨Chromeæµè§ˆå™¨ã€‚'
});
} else {
// ç»Ÿä¸€ä½¿ç”¨æƒé™å¼¹çª—æ˜¾ç¤ºé”™è¯¯
showPermissionsModal({
gist: false,
repo: false
}, {
isValid: false,
status: 'invalid',
message: `éªŒè¯å¤±è´¥: ${error.message || 'æ— æ³•è¿æ¥åˆ°GitHub APIï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'}`
});
}
}
}
// æ˜¾ç¤ºæƒé™å¼¹çª—
function showPermissionsModal(permissions, statusInfo) {
const permissionsList = document.getElementById('permissionsList');
const modalTitle = document.getElementById('permissionsModalTitle');
const modalMessage = document.getElementById('permissionsModalMessage');
const confirmBtn = document.getElementById('permissionsConfirmBtn');
if (statusInfo.isValid) {
// éªŒè¯æˆåŠŸ
modalTitle.textContent = 'æƒé™éªŒè¯ç»“æœ';
modalMessage.textContent = 'æ‚¨çš„Tokenæƒé™éªŒè¯å·²å®Œæˆï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†ä¿¡æ¯ï¼š';
confirmBtn.style.display = 'inline-block';
permissionsList.innerHTML = `
<div class="permission-item">
<div class="permission-icon ${permissions.gist ? 'permission-granted' : 'permission-denied'}">
${permissions.gist ? 'âœ“' : 'âœ—'}
</div>
<div class="permission-name">Gist æƒé™: ${permissions.gist ? '<span style="color: #28a745;">å·²æˆæƒ</span>' : '<span style="color: #dc3545;">æœªæˆæƒ</span>'}</div>
</div>
<div class="permission-item">
<div class="permission-icon ${permissions.repo ? 'permission-granted' : 'permission-denied'}">
${permissions.repo ? 'âœ“' : 'âœ—'}
</div>
<div class="permission-name">ä»“åº“ (repo) æƒé™: ${permissions.repo ? '<span style="color: #28a745;">å·²æˆæƒ</span>' : '<span style="color: #dc3545;">æœªæˆæƒ</span>'}</div>
</div>
<p style="margin-top: 15px; font-size: 13px; color: #6c757d;">
æç¤ºï¼šæƒé™æ£€æŸ¥åŸºäº GitHub API è¿”å›çš„ Token ä½œç”¨åŸŸä¿¡æ¯ã€‚
</p>
`;
} else {
// éªŒè¯å¤±è´¥
modalTitle.textContent = 'éªŒè¯å¤±è´¥';
modalMessage.textContent = 'æ— æ³•éªŒè¯æ‚¨çš„Tokenï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹ä¿¡æ¯ï¼š';
confirmBtn.style.display = 'none';
permissionsList.innerHTML = `
<div class="permission-item token-status-alert">
<div class="permission-icon permission-denied">
<i class="fas fa-exclamation-circle"></i>
</div>
<div class="permission-name">${statusInfo.message}</div>
</div>
<p style="margin-top: 15px; color: #6c757d;">
å¯èƒ½çš„åŸå› ï¼š
<ul style="margin-left: 20px; margin-top: 10px;">
<li>Token æ ¼å¼ä¸æ­£ç¡®æˆ–å·²è¿‡æœŸ</li>
<li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
<li>GitHub API ä¸´æ—¶é™åˆ¶</li>
<li>è¯·ç¡®ä¿åœ¨ <span style="color: #4a6fa5">https://zcfi.cn</span> åŸŸåä¸‹è®¿é—®</li>
</ul>
</p>
`;
}
// æ¸²æŸ“TokençŠ¶æ€ä¿¡æ¯
renderTokenStatusInfo(statusInfo);
document.getElementById('permissionsModal').classList.add('show');
}
function closePermissionsModal() {
document.getElementById('permissionsModal').classList.remove('show');
}
function confirmPermissionsAndNavigate() {
closePermissionsModal();
if (!window.tempTokenData) {
showModal('é”™è¯¯', 'Token æ•°æ®å·²ä¸¢å¤±ï¼Œè¯·é‡æ–°ç™»å½•', 'error');
return;
}
const token = window.tempTokenData.token;
const module = window.tempTokenData.selectedModule;
const permissions = window.tempTokenData.permissions;
// å¯¼èˆªåˆ°é€‰æ‹©çš„æ¨¡å—
navigateToModule(module, token, permissions);
// æ¸…é™¤ä¸´æ—¶æ•°æ®
window.tempTokenData = null;
}
function navigateToModule(module, token, permissions) {
// åˆ›å»ºä¸´æ—¶sessionStorageæ•°æ®ï¼Œä½†è®¾ç½®è¶…æ—¶è‡ªåŠ¨æ¸…é™¤
const now = Date.now();
sessionStorage.setItem('admin_token', token);
sessionStorage.setItem('admin_verified', 'true');
sessionStorage.setItem('admin_login_time', now.toString());
sessionStorage.setItem('admin_permissions', JSON.stringify(permissions));
sessionStorage.setItem('selected_module', module);
// è®¾ç½®è‡ªåŠ¨æ¸…é™¤è®¡æ—¶å™¨
setTimeout(() => {
sessionStorage.removeItem('admin_token');
sessionStorage.removeItem('admin_verified');
sessionStorage.removeItem('admin_login_time');
sessionStorage.removeItem('admin_permissions');
sessionStorage.removeItem('selected_module');
}, 300000); // 5åˆ†é’Ÿåè‡ªåŠ¨æ¸…é™¤
// è·³è½¬åˆ°å¯¹åº”æ¨¡å—
const moduleMapping = {
'blog': 'blog.html',
'portfolio': 'portfolio.html',
'contact': 'contact.html',
'config': 'config.html'
};
window.location.href = moduleMapping[module] || 'index.html';
}
function showModal(title, message, type = 'info', showCancel = false) {
const modal = document.getElementById('customModal');
const modalTitle = document.querySelector('.modal-title');
const modalMessage = document.getElementById('modalMessage');
const headerIcon = document.querySelector('.modal-header i');
const confirmBtn = document.getElementById('modalConfirmBtn');
const cancelBtn = document.getElementById('modalCancelBtn');
// è®¾ç½®ç±»å‹æ ·å¼
modal.className = `custom-modal modal-${type} show`;
// è®¾ç½®å›¾æ ‡
if (type === 'success') {
headerIcon.className = 'fas fa-check-circle';
} else if (type === 'error') {
headerIcon.className = 'fas fa-exclamation-circle';
} else {
headerIcon.className = 'fas fa-info-circle';
}
// è®¾ç½®å†…å®¹
modalTitle.textContent = title;
modalMessage.innerHTML = message.replace(/\n/g, '<br>');
// è®¾ç½®æŒ‰é’®
cancelBtn.style.display = showCancel ? 'inline-block' : 'none';
confirmBtn.textContent = showCancel ? 'ç¡®å®š' : 'å¥½çš„';
}
function showLoadingModal(message) {
const modal = document.getElementById('customModal');
const modalTitle = document.querySelector('.modal-title');
const modalMessage = document.getElementById('modalMessage');
const headerIcon = document.querySelector('.modal-header i');
const confirmBtn = document.getElementById('modalConfirmBtn');
const cancelBtn = document.getElementById('modalCancelBtn');
modal.className = 'custom-modal modal-info show';
headerIcon.className = 'fas fa-spinner fa-spin';
modalTitle.textContent = 'è¯·ç¨å€™';
modalMessage.textContent = message;
confirmBtn.style.display = 'none';
cancelBtn.style.display = 'none';
}
function closeModal() {
document.getElementById('customModal').classList.remove('show');
}
// å®‰å…¨å¢å¼ºï¼šé¡µé¢å¸è½½æ—¶å½»åº•æ¸…é™¤æ‰€æœ‰ç—•è¿¹
window.addEventListener('beforeunload', () => {
// æ¸…é™¤æ‰€æœ‰ sessionStorage
sessionStorage.clear();
// æ¸…é™¤ä¸´æ—¶å†…å­˜æ•°æ®
window.tempTokenData = null;
// æ¸…é™¤è¾“å…¥æ¡†
if (document.getElementById('token')) {
document.getElementById('token').value = '';
}
});
</script>
</body>
</html>
