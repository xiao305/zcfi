<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>管理后台 | zcfi.cn</title>
<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg">
<link rel="icon" type="image/png" sizes="96x96" href="../favicon/favicon-96x96.png">
<link rel="icon" type="image/x-icon" href="../favicon/favicon.ico">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- 后台公共CSS -->
<link rel="stylesheet" href="assets/css/admin-common.css">
<style>
/* 登录页面特定样式 */
.login-container {
background: white;
border-radius: 20px;
box-shadow: 0 15px 50px rgba(0,0,0,0.3);
width: 100%;
max-width: 600px;
padding: 40px;
text-align: center;
}
.login-logo {
font-size: 36px;
font-weight: 700;
color: #4a6fa5;
margin-bottom: 30px;
text-decoration: none;
display: inline-block;
}
.login-logo span {
color: #28a745;
}
.login-title {
color: #333;
margin-bottom: 25px;
font-size: 24px;
}
.token-input {
position: relative;
margin-bottom: 30px;
}
.token-input input {
width: 100%;
padding: 15px 20px;
border: 2px solid #dee2e6;
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
}
.token-input input:focus {
outline: none;
border-color: #4a6fa5;
box-shadow: 0 0 0 4px rgba(74, 111, 165, 0.15);
}
.modules-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 20px;
margin-top: 30px;
}
.module-card {
background: #f8f9fa;
border: 2px solid #e9ecef;
border-radius: 15px;
padding: 25px 15px;
cursor: pointer;
transition: all 0.3s ease;
text-align: center;
}
.module-card:hover {
transform: translateY(-5px);
border-color: #4a6fa5;
box-shadow: 0 8px 20px rgba(74, 111, 165, 0.2);
background: #ffffff;
}
.module-card.selected {
border-color: #4a6fa5;
background: #ffffff;
box-shadow: 0 8px 20px rgba(74, 111, 165, 0.25);
}
.module-icon {
font-size: 32px;
color: #4a6fa5;
margin-bottom: 15px;
transition: transform 0.3s ease;
}
.module-card:hover .module-icon {
transform: scale(1.2);
}
.module-title {
font-weight: 600;
color: #333;
font-size: 16px;
}
.login-btn {
width: 100%;
padding: 16px;
background: #4a6fa5;
color: white;
border: none;
border-radius: 12px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 25px;
}
.login-btn:hover {
background: #3a5a80;
transform: translateY(-2px);
}
.login-btn:disabled {
background: #6c757d;
cursor: not-allowed;
transform: none;
}
/* 模块说明样式 */
.module-description {
font-size: 13px;
color: #6c757d;
margin-top: 8px;
line-height: 1.4;
min-height: 36px;
}
/* 权限显示样式 */
.permissions-section {
margin-top: 20px;
padding: 15px;
background: #f8f9fa;
border-radius: 8px;
text-align: left;
}
.permission-item {
display: flex;
align-items: center;
margin-bottom: 8px;
}
.permission-icon {
width: 24px;
height: 24px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
margin-right: 10px;
font-size: 14px;
}
.permission-granted {
background-color: #28a745;
color: white;
}
.permission-denied {
background-color: #dc3545;
color: white;
}
.permission-name {
font-weight: 500;
}
/* Token状态提示样式 */
.token-status-section {
margin-top: 20px;
padding: 15px;
border-radius: 8px;
background: #e3f2fd;
border: 1px solid #bbdefb;
}
.token-status-warning {
background: #fff8e1;
border-color: #ffecb3;
}
.token-status-alert {
background: #ffebee;
border-color: #ffcdd2;
}
.status-label {
font-weight: 600;
margin-bottom: 5px;
display: flex;
align-items: center;
gap: 8px;
}
.status-message {
font-size: 14px;
line-height: 1.5;
}
.status-good {
color: #28a745;
}
.status-warning {
color: #ffc107;
}
.status-bad {
color: #dc3545;
}
/* 响应式调整 */
@media (max-width: 768px) {
.modules-grid {
grid-template-columns: 1fr;
}
.login-container {
padding: 30px 20px;
}
}
/* 修正：表单容器 */
.login-form {
width: 100%;
}
</style>
</head>
<body class="admin-body">
<div class="admin-container" style="max-width: 600px;">
<div class="login-container">
<a href="https://zcfi.cn" class="login-logo">zcfi<span>.</span>cn</a>
<h2 class="login-title"><i class="fas fa-lock"></i> 管理后台登录</h2>
<!-- 修正：将表单元素包裹在form标签内 -->
<form class="login-form" id="loginForm">
<div class="token-input">
<input type="password" id="token" placeholder="请输入 GitHub Personal Access Token (ghp_xxx...)" autocomplete="off">
</div>
<div class="modules-grid">
<!-- 博客管理 -->
<div class="module-card" data-module="blog">
<div class="module-icon">
<i class="fas fa-blog"></i>
</div>
<div class="module-title">博客管理</div>
<div class="module-description">管理博客文章，编辑发布新内容</div>
</div>
<!-- 作品集管理 -->
<div class="module-card" data-module="portfolio">
<div class="module-icon">
<i class="fas fa-briefcase"></i>
</div>
<div class="module-title">作品集管理</div>
<div class="module-description">管理项目作品，设置首页展示</div>
</div>
<!-- 留言管理 -->
<div class="module-card" data-module="contact">
<div class="module-icon">
<i class="fas fa-comments"></i>
</div>
<div class="module-title">留言管理</div>
<div class="module-description">查看和处理访客留言</div>
</div>
<!-- 配置面板 -->
<div class="module-card" data-module="config">
<div class="module-icon">
<i class="fas fa-cog"></i>
</div>
<div class="module-title">配置面板</div>
<div class="module-description">网站设置和法律声明配置</div>
</div>
</div>
<button class="login-btn" id="enterBtn" disabled>
<i class="fas fa-sign-in-alt"></i> 进入管理
</button>
</form>
<!-- Token使用说明 -->
<div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #6c757d;">
<p style="margin-bottom: 8px;"><i class="fas fa-info-circle" style="color: #4a6fa5;"></i> <strong>Token 安全说明：</strong></p>
<p style="font-size: 13px; line-height: 1.5;">
1. 每次登录都需要<strong>重新输入</strong>Token，系统不会保存您的Token<br>
2. 前往 <a href="https://github.com/settings/tokens" target="_blank" style="color: #4a6fa5; text-decoration: none;">GitHub Token设置</a> 创建新Token<br>
3. 基础功能需要勾选 <code>gist</code> 权限<br>
4. 高级功能（如自动生成博客页面）需要额外勾选 <code>repo</code> 权限<br>
5. <strong>安全提示：</strong> 为Token设置合理的有效期，使用后立即从GitHub删除
</p>
</div>
</div>
</div>
<!-- 使用公共弹窗样式 -->
<div class="custom-modal" id="customModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-info-circle"></i>
</div>
<div class="modal-title">提示</div>
<div class="modal-message" id="modalMessage">消息内容</div>
<div class="modal-buttons">
<button class="modal-btn btn-primary" id="modalConfirmBtn">确定</button>
<button class="modal-btn btn-secondary" id="modalCancelBtn" style="display:none;">取消</button>
</div>
</div>
</div>
<!-- 权限确认弹窗 -->
<div class="custom-modal" id="permissionsModal">
<div class="modal-content">
<div class="modal-header">
<i class="fas fa-shield-alt"></i>
</div>
<div class="modal-title">权限验证结果</div>
<div class="modal-message">
<p>您的Token权限验证已完成，以下是详细信息：</p>
<div class="permissions-section" id="permissionsList">
<!-- 权限列表将在这里动态生成 -->
</div>
<!-- Token状态信息显示区域 -->
<div class="token-status-section" id="tokenStatusSection">
<p class="status-label">
<i class="fas fa-check-circle status-good"></i> <span id="statusTitle">Token 状态: 正常</span>
</p>
<p class="status-message" id="statusMessage">
Token 当前有效，可以正常使用所有授权功能。
</p>
</div>
<p style="margin-top: 15px; font-weight: 500;">安全提醒：</p>
<ul style="text-align: left; margin-top: 10px; margin-bottom: 20px;">
<li>系统<strong>不会保存</strong>您的Token，关闭页面后需要重新输入</li>
<li>缺少<span style="color: #dc3545; font-weight: 600;">gist</span>权限将无法使用任何后台功能</li>
<li>缺少<span style="color: #4a6fa5; font-weight: 600;">repo</span>权限将无法使用<span style="color: #4a6fa5;">自动生成博客页面</span>等高级功能</li>
<li>使用完毕后，建议立即从 <a href="https://github.com/settings/tokens" target="_blank" style="color: #4a6fa5; text-decoration: none;">GitHub Token设置</a> 删除此Token</li>
</ul>
</div>
<div class="modal-buttons">
<button class="modal-btn btn-secondary" id="permissionsCancelBtn">返回</button>
<button class="modal-btn btn-primary" id="permissionsConfirmBtn">确认并继续</button>
</div>
</div>
</div>
<script>
// 安全清理：页面加载时立即清除所有可能的敏感数据
(function() {
// 清除所有 sessionStorage 数据
sessionStorage.clear();
// 清除所有 localStorage 数据
Object.keys(localStorage).forEach(key => {
if (key.toLowerCase().includes('token') || 
key.toLowerCase().includes('admin') || 
key.toLowerCase().includes('auth')) {
localStorage.removeItem(key);
}
});
// 清除输入框
setTimeout(() => {
if (document.getElementById('token')) {
document.getElementById('token').value = '';
}
}, 100);
})();
let selectedModule = null;
const BLOG_GIST_ID = '73cc78400c25eb9effed665e2c89843d';
const GIST_URL = `https://api.github.com/gists/${BLOG_GIST_ID}`;
const SCOPE_CHECK_URL = 'https://api.github.com';
// 页面加载
document.addEventListener('DOMContentLoaded', () => {
setupEventListeners();
// 确保页面加载时没有残留的token
document.getElementById('token').value = '';
updateEnterButton();
});
// 初始化事件监听器
function setupEventListeners() {
// 防止表单默认提交
document.getElementById('loginForm').addEventListener('submit', function(e) {
e.preventDefault();
if (!document.getElementById('enterBtn').disabled && selectedModule) {
validateAndLogin();
}
});
// 模块选择
document.querySelectorAll('.module-card').forEach(card => {
card.addEventListener('click', function() {
document.querySelectorAll('.module-card').forEach(c => c.classList.remove('selected'));
this.classList.add('selected');
selectedModule = this.dataset.module;
updateEnterButton();
});
});
// Token 输入
document.getElementById('token').addEventListener('input', updateEnterButton);
// 进入按钮
document.getElementById('enterBtn').addEventListener('click', validateAndLogin);
// 弹窗按钮
document.getElementById('modalConfirmBtn').addEventListener('click', closeModal);
document.getElementById('modalCancelBtn').addEventListener('click', closeModal);
// 权限弹窗按钮
document.getElementById('permissionsCancelBtn').addEventListener('click', closePermissionsModal);
document.getElementById('permissionsConfirmBtn').addEventListener('click', confirmPermissionsAndNavigate);
// 禁用浏览器自动填充
document.getElementById('token').setAttribute('autocomplete', 'off');
}
// 更新按钮状态
function updateEnterButton() {
const token = document.getElementById('token').value.trim();
const btn = document.getElementById('enterBtn');
btn.disabled = !(token && selectedModule);
}
// 检查Token权限
async function checkTokenPermissions(token) {
const permissions = {
gist: false,
repo: false
};
try {
// 1. 检查gist权限 - 添加随机参数防止缓存
const timestamp = new Date().getTime();
const gistResponse = await fetch(`${GIST_URL}?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json',
'Cache-Control': 'no-cache, no-store, must-revalidate',
'Pragma': 'no-cache',
'Expires': '0'
}
});
if (gistResponse.ok) {
permissions.gist = true;
}
} catch (error) {
console.error('检查gist权限失败:', error);
}
try {
// 2. 检查repo权限 - 从响应头获取scope信息
const scopeResponse = await fetch(`${SCOPE_CHECK_URL}?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json',
'Cache-Control': 'no-cache, no-store, must-revalidate',
'Pragma': 'no-cache',
'Expires': '0'
}
});
if (scopeResponse.ok) {
const scopesHeader = scopeResponse.headers.get('x-oauth-scopes');
if (scopesHeader) {
const scopes = scopesHeader.split(',').map(scope => scope.trim());
console.log('Token scopes:', scopes);
permissions.repo = scopes.some(scope => 
scope === 'repo' || 
scope.startsWith('repo:') || 
scope.includes('write')
);
}
}
} catch (error) {
console.error('检查repo权限失败:', error);
}
return permissions;
}
// 检查Token状态（是否有效）
async function checkTokenStatus(token) {
try {
// 尝试获取用户信息来验证token状态
const timestamp = new Date().getTime();
const response = await fetch(`https://api.github.com/user?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json',
'Cache-Control': 'no-cache, no-store, must-revalidate',
'Pragma': 'no-cache',
'Expires': '0'
}
});
if (!response.ok) {
// Token无效或权限不足
return {
isValid: false,
status: 'invalid',
message: `Token无效或权限不足。状态码: ${response.status} ${response.statusText}`
};
}
// 检查速率限制
const rateLimitRemaining = response.headers.get('x-ratelimit-remaining');
const rateLimitReset = response.headers.get('x-ratelimit-reset');
if (rateLimitRemaining !== null && parseInt(rateLimitRemaining) === 0) {
const resetTime = new Date(parseInt(rateLimitReset) * 1000);
const now = new Date();
const minutesUntilReset = Math.ceil((resetTime - now) / (1000 * 60));
if (minutesUntilReset > 0) {
return {
isValid: true,
status: 'rate_limited',
message: `Token当前被速率限制，将在约${minutesUntilReset}分钟后恢复。请稍后再试或联系GitHub支持。`
};
}
}
// Token状态良好
return {
isValid: true,
status: 'good',
message: 'Token当前有效，可以正常使用所有授权功能。'
};
} catch (error) {
console.error('检查Token状态失败:', error);
return {
isValid: false,
status: 'error',
message: '无法验证Token状态，请检查网络连接或Token是否正确。'
};
}
}
// 渲染Token状态信息
function renderTokenStatusInfo(statusInfo) {
const statusSection = document.getElementById('tokenStatusSection');
const statusTitle = document.getElementById('statusTitle');
const statusMessage = document.getElementById('statusMessage');
const statusIcon = statusSection.querySelector('.fa-check-circle');
if (statusInfo.status === 'good') {
statusSection.className = 'token-status-section';
statusTitle.innerHTML = '<i class="fas fa-check-circle status-good"></i> Token 状态: 正常';
statusMessage.className = 'status-message';
statusMessage.innerHTML = statusInfo.message;
statusIcon.className = 'fas fa-check-circle status-good';
} else if (statusInfo.status === 'rate_limited') {
statusSection.className = 'token-status-section token-status-warning';
statusTitle.innerHTML = '<i class="fas fa-exclamation-triangle status-warning"></i> Token 状态: 速率限制';
statusMessage.className = 'status-message status-warning';
statusMessage.innerHTML = statusInfo.message;
statusIcon.className = 'fas fa-exclamation-triangle status-warning';
} else {
statusSection.className = 'token-status-section token-status-alert';
statusTitle.innerHTML = '<i class="fas fa-times-circle status-bad"></i> Token 状态: 无效';
statusMessage.className = 'status-message status-bad';
statusMessage.innerHTML = statusInfo.message;
statusIcon.className = 'fas fa-times-circle status-bad';
}
}
async function validateAndLogin() {
const token = document.getElementById('token').value.trim();
if (!token.startsWith('ghp_')) {
showModal('错误', 'Token 必须以 "ghp_" 开头', 'error');
return;
}
showLoadingModal('正在验证 Token...');
try {
// 首先验证Token基本有效性
const timestamp = new Date().getTime();
const response = await fetch(`${GIST_URL}?t=${timestamp}`, {
headers: {
'Authorization': `token ${token}`,
'Accept': 'application/vnd.github.v3+json',
'Cache-Control': 'no-cache, no-store, must-revalidate',
'Pragma': 'no-cache',
'Expires': '0'
}
});
if (!response.ok) {
throw new Error(`验证失败: ${response.status} ${response.statusText}`);
}
// 验证成功，检查详细权限
closeModal();
showLoadingModal('正在检查权限...');
const permissions = await checkTokenPermissions(token);
// 检查Token状态
const statusInfo = await checkTokenStatus(token);
closeModal();
// 显示权限检查结果
showPermissionsModal(permissions, statusInfo);
// 不再存储token，只临时保存在内存中
window.tempTokenData = {
token: token,
selectedModule: selectedModule,
permissions: permissions
};
} catch (error) {
console.error('Token 验证失败:', error);
showModal('验证失败', `Token 无效或无权限访问 Gist\n错误: ${error.message}`, 'error');
}
}
function showPermissionsModal(permissions, statusInfo) {
const permissionsList = document.getElementById('permissionsList');
permissionsList.innerHTML = `
<div class="permission-item">
<div class="permission-icon ${permissions.gist ? 'permission-granted' : 'permission-denied'}">
${permissions.gist ? '✓' : '✗'}
</div>
<div class="permission-name">Gist 权限: ${permissions.gist ? '<span style="color: #28a745;">已授权</span>' : '<span style="color: #dc3545;">未授权</span>'}</div>
</div>
<div class="permission-item">
<div class="permission-icon ${permissions.repo ? 'permission-granted' : 'permission-denied'}">
${permissions.repo ? '✓' : '✗'}
</div>
<div class="permission-name">仓库 (repo) 权限: ${permissions.repo ? '<span style="color: #28a745;">已授权</span>' : '<span style="color: #dc3545;">未授权</span>'}</div>
</div>
<p style="margin-top: 15px; font-size: 13px; color: #6c757d;">
提示：权限检查基于 GitHub API 返回的 Token 作用域信息。
</p>
`;
// 渲染Token状态信息
renderTokenStatusInfo(statusInfo);
document.getElementById('permissionsModal').classList.add('show');
}
function closePermissionsModal() {
document.getElementById('permissionsModal').classList.remove('show');
}
function confirmPermissionsAndNavigate() {
closePermissionsModal();
if (!window.tempTokenData) {
showModal('错误', 'Token 数据已丢失，请重新登录', 'error');
return;
}
const token = window.tempTokenData.token;
const module = window.tempTokenData.selectedModule;
const permissions = window.tempTokenData.permissions;
// 导航到选择的模块，携带token参数
navigateToModule(module, token, permissions);
// 清除临时数据
window.tempTokenData = null;
}
function navigateToModule(module, token, permissions) {
// 在目标页面，token将通过URL参数或sessionStorage临时传递
// 但不会持久化存储
const pageMap = {
'blog': 'blog.html',
'portfolio': 'portfolio.html',
'contact': 'contact.html',
'config': 'config.html'
};
const pageUrl = pageMap[module] || 'index.html';
// 创建临时sessionStorage数据，但设置超时自动清除
const now = Date.now();
sessionStorage.setItem('admin_token', token);
sessionStorage.setItem('admin_verified', 'true');
sessionStorage.setItem('admin_login_time', now.toString());
sessionStorage.setItem('admin_permissions', JSON.stringify(permissions));
sessionStorage.setItem('selected_module', module);
// 设置自动清除计时器
setTimeout(() => {
sessionStorage.removeItem('admin_token');
sessionStorage.removeItem('admin_verified');
sessionStorage.removeItem('admin_login_time');
sessionStorage.removeItem('admin_permissions');
sessionStorage.removeItem('selected_module');
}, 300000); // 5分钟后自动清除
window.location.href = pageUrl;
}
function showModal(title, message, type = 'info', showCancel = false) {
const modal = document.getElementById('customModal');
const modalTitle = document.querySelector('.modal-title');
const modalMessage = document.getElementById('modalMessage');
const headerIcon = document.querySelector('.modal-header i');
const confirmBtn = document.getElementById('modalConfirmBtn');
const cancelBtn = document.getElementById('modalCancelBtn');
// 设置类型样式
modal.className = `custom-modal modal-${type} show`;
// 设置图标
if (type === 'success') {
headerIcon.className = 'fas fa-check-circle';
} else if (type === 'error') {
headerIcon.className = 'fas fa-exclamation-circle';
} else {
headerIcon.className = 'fas fa-info-circle';
}
// 设置内容
modalTitle.textContent = title;
modalMessage.innerHTML = message.replace(/\n/g, '<br>');
// 设置按钮
cancelBtn.style.display = showCancel ? 'inline-block' : 'none';
confirmBtn.textContent = showCancel ? '确定' : '好的';
}
function showLoadingModal(message) {
const modal = document.getElementById('customModal');
const modalTitle = document.querySelector('.modal-title');
const modalMessage = document.getElementById('modalMessage');
const headerIcon = document.querySelector('.modal-header i');
const confirmBtn = document.getElementById('modalConfirmBtn');
const cancelBtn = document.getElementById('modalCancelBtn');
modal.className = 'custom-modal modal-info show';
headerIcon.className = 'fas fa-spinner fa-spin';
modalTitle.textContent = '请稍候';
modalMessage.textContent = message;
confirmBtn.style.display = 'none';
cancelBtn.style.display = 'none';
}
function closeModal() {
document.getElementById('customModal').classList.remove('show');
}
// 安全增强：页面卸载时彻底清除所有痕迹
window.addEventListener('beforeunload', () => {
// 清除所有 sessionStorage
sessionStorage.clear();
// 清除临时内存数据
window.tempTokenData = null;
// 清除输入框
if (document.getElementById('token')) {
document.getElementById('token').value = '';
}
// 清除可能的缓存
if (window.caches) {
caches.keys().then(cacheNames => {
cacheNames.forEach(cacheName => {
caches.delete(cacheName);
});
});
}
});
// 禁用浏览器缓存
document.addEventListener('DOMContentLoaded', () => {
if ('serviceWorker' in navigator) {
navigator.serviceWorker.getRegistrations().then(registrations => {
registrations.forEach(registration => {
registration.unregister();
});
});
}
});
</script>
</body>
</html>
