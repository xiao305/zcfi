<footer>
    <div class="container">
        <div class="footer-content">
            <div class="footer-about">
                <a href="#" class="footer-logo" id="footerSiteLogo"></a>
                <p id="siteDescriptionFooter"></p>
                <div class="social-links" id="footerSocialLinks"></div>
            </div>
            <div class="footer-links">
                <h3 class="footer-heading">快速链接</h3>
                <ul id="footerQuickLinks"></ul>
            </div>
            <div class="footer-links">
                <h3 class="footer-heading">法律声明</h3>
                <ul id="footerLegalLinks"></ul>
            </div>
        </div>
        
        <div class="compliance">
            <p id="copyrightText"></p>
            <div class="compliance-links" id="complianceLinks"></div>
        </div>
    </div>
</footer>

<script>
console.log('footer.html脚本开始执行', Date.now());

// 页脚配置加载器
class FooterLoader {
    constructor() {
        this.CONFIG_GIST_ID = '983bb7371ddb439a2fcbfb4885e34d14';
        this.configData = null;
    }

    async loadConfig() {
        if (this.configData) return this.configData;
        
        try {
            const timestamp = Date.now();
            const response = await fetch(
                `https://gist.githubusercontent.com/xiao305/${this.CONFIG_GIST_ID}/raw/config.json?t=${timestamp}`
            );
            
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            
            this.configData = await response.json();
            return this.configData;
        } catch (error) {
            console.error('页脚配置加载失败:', error);
            return this.getEmptyConfig();
        }
    }

    getEmptyConfig() {
        return {
            site: { name: '' },
            footer: {
                description: '',
                quickLinks: [],
                legalLinks: [],
                social: {},
                copyright: ''
            }
        };
    }

    escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    normalizeUrl(url) {
        if (!url) return '#';
        if (url.startsWith('http://') || url.startsWith('https://') || url.startsWith('/')) {
            return url;
        }
        return url;
    }

    async render() {
        const config = await this.loadConfig();
        const site = config.site || {};
        const footer = config.footer || {};
        
        // 1. 更新Logo
        const footerLogo = document.getElementById('footerSiteLogo');
        if (footerLogo) {
            footerLogo.innerHTML = site.name ? 
                `${this.escapeHtml(site.name)}<span>.</span>cn` : 
                'zcfi<span>.</span>cn';
            footerLogo.href = this.normalizeUrl('./');
        }
        
        // 2. 更新描述
        const footerDesc = document.getElementById('siteDescriptionFooter');
        if (footerDesc) {
            footerDesc.textContent = footer.description || '';
        }
        
        // 3. 更新版权
        const copyrightText = document.getElementById('copyrightText');
        if (copyrightText) {
            copyrightText.textContent = footer.copyright || `© ${new Date().getFullYear()} zcfi.cn 版权所有`;
        }
        
        // 4. 更新快速链接
        const quickLinksContainer = document.getElementById('footerQuickLinks');
        if (quickLinksContainer) {
            if (footer.quickLinks && Array.isArray(footer.quickLinks)) {
                const linksHtml = footer.quickLinks
                    .filter(link => link && link.name && link.url)
                    .map(link => `
                        <li><a href="${this.normalizeUrl(link.url)}">${this.escapeHtml(link.name)}</a></li>
                    `).join('');
                quickLinksContainer.innerHTML = linksHtml;
            } else {
                quickLinksContainer.innerHTML = '';
            }
        }
        
        // 5. 更新法律声明链接
        const legalLinksContainer = document.getElementById('footerLegalLinks');
        if (legalLinksContainer) {
            if (footer.legalLinks && Array.isArray(footer.legalLinks)) {
                const linksHtml = footer.legalLinks
                    .filter(link => link && link.name && link.url)
                    .map(link => `
                        <li><a href="${this.normalizeUrl(link.url)}">${this.escapeHtml(link.name)}</a></li>
                    `).join('');
                legalLinksContainer.innerHTML = linksHtml;
            } else {
                legalLinksContainer.innerHTML = '';
            }
        }
        
        // 6. 更新合规声明链接
        const complianceLinksContainer = document.getElementById('complianceLinks');
        if (complianceLinksContainer) {
            if (footer.legalLinks && Array.isArray(footer.legalLinks)) {
                const linksHtml = footer.legalLinks
                    .filter(link => link && link.name && link.url)
                    .map(link => `
                        <a href="${this.normalizeUrl(link.url)}">${this.escapeHtml(link.name)}</a>
                    `).join('');
                complianceLinksContainer.innerHTML = linksHtml;
            } else {
                complianceLinksContainer.innerHTML = '';
            }
        }
        
        // 7. 更新社交媒体链接
        const socialLinksContainer = document.getElementById('footerSocialLinks');
        if (socialLinksContainer) {
            const social = footer.social || {};
            let socialHtml = '';
            
            const socialPlatforms = [
                { key: 'github', icon: 'fab fa-github', title: 'GitHub' },
                { key: 'weibo', icon: 'fab fa-weibo', title: '微博' },
                { key: 'zhihu', icon: 'fab fa-zhihu', title: '知乎' },
                { key: 'linkedin', icon: 'fab fa-linkedin', title: 'LinkedIn' }
            ];
            
            socialPlatforms.forEach(platform => {
                if (social[platform.key] && social[platform.key].trim()) {
                    socialHtml += `
                        <a href="${this.normalizeUrl(social[platform.key])}" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           title="${platform.title}">
                            <i class="${platform.icon}"></i>
                        </a>
                    `;
                }
            });
            
            socialLinksContainer.innerHTML = socialHtml;
        }
    }
}

// 初始化
document.addEventListener('DOMContentLoaded', () => {
    const footerLoader = new FooterLoader();
    setTimeout(() => footerLoader.render(), 100);
});
</script>
