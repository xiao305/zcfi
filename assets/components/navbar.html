<header>
    <div class="container" id="navbar-container">
        <nav class="navbar">
            <!-- 网站Logo将通过配置动态生成 -->
            <a href="./" class="logo" id="siteLogo">zcfi<span>.</span>cn</a>
            <!-- 导航菜单将通过配置动态生成 -->
            <ul class="nav-links" id="mainNavLinks">
                <li><a href="./" class="nav-link">首页</a></li>
                <li><a href="portfolio.html" class="nav-link">作品集</a></li>
                <li><a href="blog.html" class="nav-link">博客</a></li>
                <li><a href="contact.html" class="nav-link">联系我</a></li>
            </ul>
            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </nav>
    </div>
</header>

<script>
// 在DOM加载完成后初始化导航栏
document.addEventListener('DOMContentLoaded', function() {
    // 检查是否已定义siteConfigLoader，如果没有则加载它
    if (typeof window.siteConfig === 'undefined') {
        const script = document.createElement('script');
        script.src = '../assets/js/config-loader.js';
        script.onload = function() {
            initNavbar();
        };
        document.head.appendChild(script);
    } else {
        initNavbar();
    }
});

function initNavbar() {
    // 加载网站配置
    window.siteConfig.loadConfig().then(config => {
        // 更新Logo
        const siteLogo = document.getElementById('siteLogo');
        if (siteLogo && config.site) {
            siteLogo.innerHTML = `${config.site.name}<span>.</span>cn`;
        }
        
        // 更新导航菜单
        const navLinksContainer = document.getElementById('mainNavLinks');
        if (navLinksContainer && config.navigation && config.navigation.items) {
            // 按order排序
            const sortedNav = [...config.navigation.items].sort((a, b) => (a.order || 0) - (b.order || 0));
            
            // 生成导航链接
            const navLinksHTML = sortedNav.map(item => {
                // 获取当前页面路径
                const currentPage = window.location.pathname.split('/').pop();
                const isCurrentPage = currentPage === '' || currentPage === 'index.html' 
                    ? item.url === './' || item.url === 'index.html' 
                    : item.url.includes(currentPage);
                    
                const activeClass = isCurrentPage ? 'active' : '';
                return `<li><a href="${item.url}" class="nav-link ${activeClass}">${item.name}</a></li>`;
            }).join('');
            
            // 更新DOM
            navLinksContainer.innerHTML = navLinksHTML;
        }
    }).catch(error => {
        console.error('加载导航配置失败:', error);
        // 保持默认导航
    });
    
    // 初始化移动端菜单
    initMobileMenu();
}

// 初始化移动端菜单
function initMobileMenu() {
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const navLinks = document.querySelector('.nav-links');
    
    if (!mobileMenuBtn || !navLinks) return;
    
    mobileMenuBtn.addEventListener('click', () => {
        navLinks.classList.toggle('active');
        const icon = mobileMenuBtn.querySelector('i');
        if (navLinks.classList.contains('active')) {
            icon.className = 'fas fa-times';
        } else {
            icon.className = 'fas fa-bars';
        }
    });
    
    // 点击导航链接关闭菜单
    const navItems = navLinks.querySelectorAll('a');
    navItems.forEach(item => {
        item.addEventListener('click', () => {
            navLinks.classList.remove('active');
            const icon = mobileMenuBtn.querySelector('i');
            icon.className = 'fas fa-bars';
        });
    });
}
</script>
