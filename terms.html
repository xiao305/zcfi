<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>使用条款 | zcfi.cn</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon/favicon-96x96.png">
    <link rel="icon" type="image/x-icon" href="../favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../favicon/apple-touch-icon.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="../favicon/site.webmanifest">
    
    <!-- Web App Icons -->
    <link rel="apple-touch-icon" sizes="192x192" href="../favicon/web-app-manifest-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="../favicon/web-app-manifest-512x512.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    
    <style>
        /* 保持原有样式 */
        .terms-container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-top: 20px;
        }
        
        .terms-container h3 {
            margin: 30px 0 15px;
            color: var(--dark-color);
            font-size: 1.3rem;
        }
        
        .terms-container p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .terms-container ul {
            margin: 15px 0 20px;
            padding-left: 20px;
        }
        
        .terms-container li {
            margin-bottom: 8px;
        }
        
        .terms-container strong {
            color: var(--dark-color);
        }
        
        .loading-message {
            text-align: center;
            color: #777;
            padding: 40px;
            font-style: italic;
        }
        
        .error-message {
            text-align: center;
            color: #e74c3c;
            padding: 40px;
            background: #fdf2f2;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .last-updated {
            text-align: right;
            color: #666;
            font-size: 14px;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        /* 页面内容调整，避免被导航栏遮挡 */
        main {
            margin-top: 100px;
            padding: 60px 0;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .terms-container {
                padding: 25px;
            }
            
            main {
                margin-top: 80px;
                padding: 40px 0;
            }
        }
        
        @media (max-width: 480px) {
            .terms-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- 头部导航容器（与首页相同） -->
    <div id="navbar-container"></div>

    <!-- 主内容 -->
    <main>
        <div class="container">
            <div class="section-title">
                <h2 id="pageTitle">使用条款</h2>
                <p id="pageSubtitle">加载中...</p>
            </div>
            <div class="terms-container" id="contentContainer">
                <div class="loading-message">正在加载使用条款内容...</div>
            </div>
        </div>
    </main>

    <!-- 页脚容器（与首页相同） -->
    <div id="footer-container"></div>

    <!-- Gist渲染器（与首页相同，路径调整） -->
    <script src="../assets/js/gist-renderer.js"></script>
    
    <!-- 页面初始化 -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('使用条款页面开始加载...');
            
            // 确保GistRenderer已加载（与首页相同）
            if (!window.gistRenderer) {
                console.error('gist-renderer.js未正确加载');
                showErrorFallback();
                return;
            }
            
            try {
                // 加载网站配置（与首页相同）
                const configData = await window.gistRenderer.loadConfig();
                
                // 更新页面标题
                if (configData.site && configData.site.name) {
                    document.title = `${configData.site.name} | 使用条款`;
                }
                
                // 渲染导航栏和页脚（与首页相同）
                await window.gistRenderer.renderAll();
                
                // 加载使用条款内容
                loadTermsContent(configData);
                
            } catch (error) {
                console.error('初始化失败:', error);
                showErrorFallback();
            }
        });
        
        // 加载使用条款内容
        async function loadTermsContent(configData) {
            try {
                // 检查使用条款是否启用
                if (!configData.terms || !configData.terms.enabled) {
                    showDisabledMessage();
                    return;
                }
                
                // 更新页面标题
                document.getElementById('pageTitle').textContent = configData.terms.title || '使用条款';
                
                // 更新子标题
                const pageSubtitle = document.getElementById('pageSubtitle');
                if (pageSubtitle) {
                    if (configData.terms.lastUpdated) {
                        const date = new Date(configData.terms.lastUpdated);
                        const dateStr = date.toLocaleDateString('zh-CN', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        pageSubtitle.innerHTML = `<i class="fas fa-history"></i> 最后更新: ${dateStr}`;
                    } else {
                        pageSubtitle.textContent = '';
                    }
                }
                
                // 填充内容
                const contentContainer = document.getElementById('contentContainer');
                if (configData.terms.content) {
                    contentContainer.innerHTML = configData.terms.content;
                    
                    // 添加最后更新时间戳
                    if (configData.terms.lastUpdated) {
                        const lastUpdatedDiv = document.createElement('div');
                        lastUpdatedDiv.className = 'last-updated';
                        lastUpdatedDiv.innerHTML = `<p><i class="fas fa-clock"></i> 最后更新时间: ${configData.terms.lastUpdated}</p>`;
                        contentContainer.appendChild(lastUpdatedDiv);
                    }
                } else {
                    contentContainer.innerHTML = '<div class="error-message"><p><i class="fas fa-exclamation-circle"></i> 使用条款内容为空</p></div>';
                }
                
            } catch (error) {
                console.error('加载使用条款内容失败:', error);
                showErrorMessage('加载内容失败，请检查网络连接或稍后重试');
            }
        }
        
        // 显示禁用消息
        function showDisabledMessage() {
            document.getElementById('pageTitle').textContent = '页面不可用';
            document.getElementById('pageSubtitle').textContent = '';
            
            const contentContainer = document.getElementById('contentContainer');
            contentContainer.innerHTML = `
                <div class="error-message">
                    <p><i class="fas fa-eye-slash"></i> 该页面暂时不可用</p>
                    <p style="margin-top: 10px;">使用条款页面当前已被管理员禁用。</p>
                    <a href="../index.html" style="display: inline-block; margin-top: 15px; padding: 10px 20px; background: #4a6fa5; color: white; border-radius: 5px; text-decoration: none;">
                        <i class="fas fa-home"></i> 返回首页
                    </a>
                </div>
            `;
        }
        
        // 显示错误消息
        function showErrorMessage(message) {
            document.getElementById('pageTitle').textContent = '加载失败';
            document.getElementById('pageSubtitle').textContent = '';
            
            const contentContainer = document.getElementById('contentContainer');
            contentContainer.innerHTML = `
                <div class="error-message">
                    <p><i class="fas fa-exclamation-triangle"></i> ${message}</p>
                    <button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #4a6fa5; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-redo"></i> 重新加载
                    </button>
                </div>
            `;
        }
        
        // 全局加载失败处理
        function showErrorFallback() {
            const contentContainer = document.getElementById('contentContainer');
            
            if (contentContainer && contentContainer.innerHTML.includes('正在加载')) {
                contentContainer.innerHTML = `
                    <div class="error-message">
                        <p>❌ 页面初始化失败</p>
                        <p>请检查网络连接，或稍后重试。</p>
                        <a href="../index.html" style="display: inline-block; margin-top: 15px; padding: 10px 20px; background: #4a6fa5; color: white; border-radius: 5px; text-decoration: none;">
                            <i class="fas fa-home"></i> 返回首页
                        </a>
                    </div>
                `;
            }
        }
    </script>
    
    <!-- 主交互脚本（与首页相同，路径调整） -->
    <script src="../assets/js/main.js"></script>
</body>
</html>
